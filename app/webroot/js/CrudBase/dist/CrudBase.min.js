class AddrLatLng{constructor(t){t=this._setParamIfEmpty(t),this.tDiv=jQuery("#"+t.div_xid),this.param=t,this.map,this.infoWindow1,this.marker,this.geocoder,this.init_flg=!1,this.wrapDiv=this.tDiv.find(t.wrap_slt),this.addrElm=this.tDiv.find(t.address_tb_slt),this.latElm=this.tDiv.find(t.lat_tb_slt),this.lngElm=this.tDiv.find(t.lng_tb_slt),this.errElm=this.tDiv.find(t.err_slt)}_setParamIfEmpty(t){return null==t&&(t={}),null==t.div_xid&&(t.div_xid="addr_lat_lng"),null==t.wrap_slt&&(t.wrap_slt=".allex_map_w"),null==t.map_slt&&(t.map_slt=".allex_map"),null==t.address_tb_slt&&(t.address_tb_slt=".allex_address"),null==t.lat_tb_slt&&(t.lat_tb_slt=".allex_lat"),null==t.lng_tb_slt&&(t.lng_tb_slt=".allex_lng"),null==t.err_slt&&(t.err_slt=".allex_err"),null==t.def_lat&&(t.def_lat=35.670528),null==t.def_lng&&(t.def_lng=139.72014),null==t.lat&&(t.lat=t.def_lat),null==t.lng&&(t.lng=t.def_lng),null==t.zoom&&(t.zoom=15),t}init(){let t=this.param,e=this.tDiv.find(t.map_slt),i=new google.maps.Map(e[0],{center:new google.maps.LatLng(t.lat,t.lng),zoom:t.zoom});this.map=i;let a=new google.maps.Marker({map:i,position:new google.maps.LatLng(t.lat,t.lng)});this.marker=a,i.addListener("click",t=>{this._clickOnMap(t)}),this.init_flg=!0}_clickOnMap(t){let e=t.latLng,i=e.lat(),a=e.lng();t.placeId;this.latElm.val(i),this.lngElm.val(a),this.param.lat=i,this.param.lng=a}addrLatLngShowMap(t){this.wrapDiv.show(),this._errShow(""),0==this.init_flg&&this.init();let e=this.param,i=this.latElm.val(),a=this.lngElm.val();this._empty(i)&&(i=e.def_lat),this._empty(a)&&(a=e.def_lng);let r=new google.maps.LatLng(i,a);this.map.setCenter(r),this.marker.setPosition(r),this.param.lat=i,this.param.lng=a}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}addrLatLngAutoSet(t){this._errShow("");let e=this.addrElm.val();this._empty(e)?this._errShow("住所を入力してください"):(null==this.geocoder&&(this.geocoder=new google.maps.Geocoder),this.geocoder.geocode({address:e},(t,e)=>{if("OK"===e&&t[0]){let e=t[0],i=e.geometry.location.lat(),a=e.geometry.location.lng();this.latElm.val(i),this.lngElm.val(a),this.init_flg&&(this.map.setCenter(e.geometry.location),this.marker.setPosition(e.geometry.location))}else this._errShow("住所の場所は見つかりませんでした。")}))}_errShow(t){this.errElm.html(t)}addrLatLngEditShow(){if(0==this.init_flg)return;let t=this.param;this._errShow("");let e=this.latElm.val(),i=this.lngElm.val();this._empty(e)&&(e=t.def_lat),this._empty(i)&&(i=t.def_lng);let a=new google.maps.LatLng(e,i);this.map.setCenter(a),this.marker.setPosition(a),this.param.lat=e,this.param.lng=i}}
/**
 * 住所緯度経度・編集機能【拡張】 | AddrLatLngのラッパークラス 
 * 
 * @note
 * Yahoo ジオコーダに対応
 * 
 * @date 2019-8-2 | 2019-8-16
 * @license MIT
 * @version 1.0.1
 */class AddrLatLngEx{init(t){this.param=this._setParamIfEmpty(t),this.tDiv=jQuery("#"+this.param.div_xid);let e=this._createHtml(this.param);this.tDiv.html(e),this.addrLatLng=new AddrLatLng(this.param),this.fShowBtn=this.tDiv.find(".allex_f_show_btn"),this.funcDiv=this.tDiv.find(".allex_func_div"),this.resDiv=this.tDiv.find(".allex_res"),this.errDiv=this.tDiv.find(".allex_err"),this.yAutoSetBtn=this.tDiv.find(".allex_y_auto_set_btn"),this.byGApiBtn=this.tDiv.find(".allex_by_g_api_btn"),this.gApiDiv=this.tDiv.find(".allex_g_api_div"),this.showMapBtn=this.tDiv.find(".allex_show_map_btn"),this.autoSetBtn=this.tDiv.find(".allex_auto_set_btn"),this.mapWrap=this.tDiv.find(".allex_map_w"),this.mapCloseBtn=this.tDiv.find(".allex_map_close_btn"),this.addrElm=this.tDiv.find(t.address_tb_slt),this.latElm=this.tDiv.find(t.lat_tb_slt),this.lngElm=this.tDiv.find(t.lng_tb_slt),this._addClickYAutoSetBtn(this.yAutoSetBtn),this._addClickByGApiBtn(this.byGApiBtn),this._addClickFShowBtn(this.fShowBtn),this._addClickShowMapBtn(this.showMapBtn),this._addClickAutoSetBtn(this.autoSetBtn),this._addClickMapCloseBtn(this.mapCloseBtn)}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.div_xid&&(t.div_xid="addr_lat_lng_ex"),null==t.wrap_slt&&(t.wrap_slt=".allex_map_w"),null==t.map_slt&&(t.map_slt=".allex_map"),null==t.address_tb_slt&&(t.address_tb_slt=".allex_address"),null==t.lat_tb_slt&&(t.lat_tb_slt=".allex_lat"),null==t.lng_tb_slt&&(t.lng_tb_slt=".allex_lng"),null==t.err_slt&&(t.err_slt=".allex_err"),null==t.ajax_url_y_auto_set)throw"'ajax_url_y_auto_set' is empty!";return null==t.address_field&&(t.address_field="address"),t}_createHtml(t){return`\n\t\t<input class='allex_f_show_btn btn btn-primary btn-xs' type="button" value='住所緯度経度・編集' />\n\t\t<div class='allex_func_div' style="display:none">\n\t\t\t<div style="width:100%">\n\t\t\t\t住所: <input type="text" name="${t.address_field}" class="allex_address valid" value=""  maxlength="200" title="200文字以内で入力してください" style="width:100%;" />\n\t\t\t\t<label class="text-danger" for="${t.address_field}"></label>\n\t\t\t</div>\n\t\t\t<div class='cbf_input' style="margin-right:8px">\n\t\t\t\t緯度: <input type="text" name="lat" class="allex_lat valid" value=""  pattern="[+-]?[0-9]+[.]?[0-9]*([eE][+-])?[0-9]*" maxlength="64" title="数値を入力してください" />\n\t\t\t\t<label class="text-danger" for="lat"></label>\n\t\t\t</div>\n\t\t\t<div class='cbf_input' style="margin-right:8px">\n\t\t\t\t経度: <input type="text" name="lng" class="allex_lng valid" value=""  pattern="[+-]?[0-9]+[.]?[0-9]*([eE][+-])?[0-9]*" maxlength="64" title="数値を入力してください" />\n\t\t\t\t<label class="text-danger" for="lng"></label>\n\t\t\t</div>\n\t\t\t\n\t\t\t<input type="button" class="allex_y_auto_set_btn btn btn-success btn-xs" value="緯度経度取得【Yahoo版】" title="Yahoo APIを利用して住所から緯度経度を取得します。無料機能ですが失敗率は高めです。" />\n\t\t\t<input type="button" class="allex_by_g_api_btn btn btn-info btn-xs" value="Google APIモード" title="Google APIによる緯度経度取得機能を表示します。" />\n\t\t\t<div class="allex_g_api_div" style="display:none;padding:15px;border:solid 3px #FF7373;border-radius:5px;background-color:#FFEEEE">\n\t\t\t\t<div class='cbf_input' style="margin-right:8px">\n\t\t\t\t\t<input type="button" class="allex_auto_set_btn btn btn-danger btn-xs" value="緯度経度設定【Google版】" title="Google APIを利用して住所から緯度経度を取得します。ボタンを押すごとに$0.005の利用料金が発生します。（無料枠あり。2019年時点）" />\n\t\t\t\t\t<input type="button" class="allex_show_map_btn btn btn-primary btn-xs" value="地図から設定" title="地図上をクリックして緯度経度の設定ができます。" />\n\t\t\t\t</div>\n\t\t\t\n\t\t\t\t<div class="allex_map_w" style="display:none;">\n\t\t\t\t\t<input type="button" class="allex_map_close_btn btn btn-default btn-xs" value="閉じる" title="地図閉じるボタン" />\n\t\t\t\t\t<div class="allex_map" style="width:100%;height:400px;"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="allex_err text-danger" style="color:red"></div>\n\t\t\t<div class="allex_res text-success"></div>\n\t\t\t\n\t\t</div>\n\t\t`}_showMsg(t){this.resDiv.html(t)}_showErr(t){this.errDiv.html(t+"<br>")}_addClickFShowBtn(t){t.click(t=>{var e=this.funcDiv.css("display");if(null==e|"none"==e){let t=this._getFShowBtnName(0);this.fShowBtn.val(t),this.tDiv.css("display","block"),this.funcDiv.show(300)}else{let t=this._getFShowBtnName(1);this.fShowBtn.val(t),this.tDiv.css("display","inline-block"),this.funcDiv.hide(300)}})}_getFShowBtnName(t){let e=this.fShowBtn.val();return 1==t?e=e.replace(" (閉じる)",""):e+=" (閉じる)",e}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}_addClickYAutoSetBtn(t){t.click(t=>{this.clickYAutoSetBtn()})}_addClickByGApiBtn(t){t.click(t=>{this.gApiDiv.toggle(100)})}_addClickShowMapBtn(t){t.click(e=>{this.addrLatLngShowMap(t)})}_addClickAutoSetBtn(t){t.click(e=>{this.addrLatLngAutoSet(t)})}addrLatLngShowMap(t){t=jQuery(t);this.addrLatLng.addrLatLngShowMap(t)}addrLatLngAutoSet(t){t=jQuery(t);this.addrLatLng.addrLatLngAutoSet(t)}_addClickMapCloseBtn(t){t.click(t=>{this.mapWrap.hide(),this.gApiDiv.hide()})}addrLatLngEditShow(){this.addrLatLng.addrLatLngEditShow()}clickYAutoSetBtn(){this._showMsg("住所から緯度経度を取得中です...");let t=this.addrElm.val();if(t=t.trim(),this._empty(t))return void this._showErr("住所を入力してください。");let e={address:t=t.replace(/&/g,"%26")};var i=JSON.stringify(e);jQuery.ajax({type:"POST",url:this.param.ajax_url_y_auto_set,data:"key1="+i,cache:!1,dataType:"text"}).done((t,e)=>{var i;try{i=jQuery.parseJSON(t)}catch(e){return void this._showErr(t)}this._showMsg(""),0!=i.lat&&0!=i.lng?(this.latElm.val(i.lat),this.lngElm.val(i.lng)):this._showErr("入力の住所からは緯度経度は取得できませんでした。Google API版をお試しください。")}).fail((t,e,i)=>{this._showMsg(""),this._showErr(t.responseText),alert(e)})}}class AjaxLoginWithCake{constructor(t){this.param=this._setParamIfEmpty(t)}_setParamIfEmpty(t){return null==t&&(t={}),null==t.btn_type&&(t.btn_type=1),null==t.login_check_url&&(t.login_check_url="ajax_login_with_cake/login_check"),null==t.login_url&&(t.login_url="ajax_login_with_cake/login_rap"),null==t.logout_url&&(t.logout_url="users/logout"),this._isEmpty(t.callback)&&(t.callback=null),this._isEmpty(t.form_slt)&&(t.form_slt="#ajax_login_with_cake"),t}_margeParam(t){return this.param=Object.assign({},this.param,t),this.param}loginCheckEx(t){this._getUrlQuery();this.loginCheck(t)}loginCheck(t){t=this._margeParam(t);var e=JSON.stringify({dummy:1});$.ajax({type:"POST",url:t.login_check_url,data:"key1="+e,cache:!1,dataType:"text"}).done((e,i)=>{try{var a=jQuery.parseJSON(e)}catch(t){throw alert("エラー"+e),new Error(e)}this._showBtns(a),null!=t.callback&&callBack(a.auth_flg)}).fail((t,e,i)=>{jQuery("#err").html(t.responseText),alert(e)})}_showBtns(t){var e=this.param.form_slt,i=jQuery(e);if(1==t.auth_flg){var a=this._getLogoutBtnHtml();i.html(a)}else{var r=this._getLoginBtnHtml();i.html(r)}}_getLogoutBtnHtml(){var t=this.param.logout_url;return 1==this.param.btn_type?"<span class='text-success'>認証中です </span><a href='"+t+"' id='logout_btn' class='btn btn-default btn-xs'>ログアウト</a>":"<a href='"+t+"' id='logout_btn'>ログアウト</a>"}_getLoginBtnHtml(){var t=this.param.login_url;return 1==this.param.btn_type?"<a id='login_btn' href='"+t+"' class='btn btn-primary' >ログイン</a>":"<a id='login_btn' href='"+t+"' >ログイン</a>"}_getUrlQuery(){if(""==(t=window.location.search)||null==t)return{};for(var t=t.substring(1,t.length),e=t.split("&"),i={},a=0;a<e.length;a++){var r=e[a].split("=");i[r[0]]=r[1]}return i}_isEmpty(t){return""==t||null==t||0==t}_isSet(t){return""!=t&&null!=t&&0!=t}}
/**
 * 一括削除クラス
 * @date 2019-7-27 | 2019-8-16
 * @license MIT
 * @version 1.0.1
 */class BulkDelete{init(t,e){this.param=this._setParamIfEmpty(e),this.tDiv=jQuery("#"+this.param.div_xid);let i=this._createHtml(t);this.tDiv.html(i),this.fShowBtn=this.tDiv.find(".bulk_del_f_show_btn"),this.funcDiv=this.tDiv.find(".bulk_del_func_div"),this.resDiv=this.tDiv.find(".bulk_del_res"),this.errDiv=this.tDiv.find(".bulk_del_err"),this.startBtn=this.tDiv.find(".bulk_del_start_btn"),this.inpsDiv=this.tDiv.find(".bulk_del_inps"),this._addClickFShowBtn(this.fShowBtn),this._addClickStartBtn(this.startBtn),this.delCnds=t}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.div_xid&&(t.div_xid="bulk_delete"),null==t.ajax_url)throw new Error("'ajax_url' is empty!");return t}_createHtml(t){return`\n\t<input class='bulk_del_f_show_btn btn btn-primary btn-xs' type="button" value='条件指定・一括削除' />\n\t<div class='bulk_del_func_div' style="display:none">\n\t\t<div style="display:inline-block;padding:10px;border:solid 4px #5bd59e;border-radius:5px;margin-bottom:10px">\n\t\t\t<p>条件指定・一括削除</p>\n\t\t\t<div class="bulk_del_inps" style="padding-bottom:16px">${this._makeInpsHtml(t)}</div>\n\t\t\t<input class="bulk_del_start_btn btn btn-danger btn-xs" type='button' value="削除実行" />\n\t\t\t<div class="bulk_del_res text-success"></div>\n\t\t\t<div class="bulk_del_err text-danger"></div>\n\t\t</div>\n\t</div>\n\t\t`}_makeInpsHtml(t){let e="";for(let i in t){let a=t[i];switch(a.inp_type){case"text":e+=this._makeInpHtmlText(a);break;case"select":e+=this._makeInpHtmlSelect(a)}}return e}_makeInpHtmlText(t){return`<input type="text" class="${t.field}" placeholder="${t.wamei}">`}_makeInpHtmlSelect(t){let e="",i=t.hashmap;for(let t in i){e+=`<option value="${t}">${i[t]}</option>`}return`\n\t\t\t<select  class="${t.id_field}">\n\t\t\t\t<option value=''>-- ${t.wamei}(未選択) --</option>\n\t\t\t\t${e}\n\t\t\t</select>\n\t\t\t\t`}_showErr(t){this.errDiv.append(t+"<br>")}_addClickFShowBtn(t){t.click(t=>{var e=this.funcDiv.css("display");if(null==e|"none"==e){this.resDiv.html("入力した条件に一致するデータを削除します。");let t=this._getFShowBtnName(0);this.fShowBtn.val(t),this.tDiv.css("display","block"),this.funcDiv.show(300)}else{let t=this._getFShowBtnName(1);this.fShowBtn.val(t),this.tDiv.css("display","inline-block"),this.funcDiv.hide(300)}})}_getFShowBtnName(t){let e=this.fShowBtn.val();return 1==t?e=e.replace(" (閉じる)",""):e+=" (閉じる)",e}_addClickStartBtn(t){t.click(t=>{window.confirm("削除を実行します。よろしいですか？")&&this._clickStartBtn()})}_clickStartBtn(){this.resDiv.html("削除中です。しばらくお待ちください...");let t=this._getKjsFromInps();this.deleteByKjs(t)}deleteByKjs(t){let e={kjs:t};e=this._escapeForAjax(e),e=this._ampTo26(e);let i=JSON.stringify(e);jQuery.ajax({type:"POST",url:this.param.ajax_url,data:"key1="+i,cache:!1,dataType:"text"}).done((t,e)=>{try{jQuery.parseJSON(t)}catch(e){return void this._showErr(t)}this.resDiv.html("削除が完了しました。"),location.reload(!0)}).fail((t,e,i)=>{this._showErr(t.responseText),alert(e)})}_getKjsFromInps(){let t={};for(let e in this.delCnds){let i=this.delCnds[e],a=null;switch(i.inp_type){case"text":a=this._getValueFromTextbox(i);break;case"select":a=this._getValueFromSelect(i)}null!=a&&(t[a.field]=a.value)}return t}_getValueFromTextbox(t){let e=t.field;return{field:e,value:this.inpsDiv.find("."+e).val()}}_getValueFromSelect(t){let e=t.id_field;return{field:e,value:this.inpsDiv.find("."+e).val()}}_escapeForAjax(t){if("string"==typeof t)return-1!=t.indexOf("&")?(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),encodeURIComponent(t)):t;if("object"==typeof t){for(var e in t)t[e]=this._escapeForAjax(t[e]);return t}return t}_ampTo26(t){if("string"==typeof t)return-1!=t.indexOf("&")?t.replace(/&/g,"%26"):t;if("object"==typeof t){for(var e in t)t[e]=this._ampTo26(t[e]);return t}return t}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}class CalendarViewK{create(t,e,i){t=this._shapingDateInData(t,e);var a=this._getBaseMonthStart(t,e);if(null!=a){var r=this._getMonthEndDate(a),n=this._createCalendarDataFormat(a,r),l=this._aggByDateField(t,e);n=this._mappingToCalData(n,l),n=this._weekStructConv(n),null==i&&(i=this._callback);var s=this._buildCalendarViewHtml(n,i,a);jQuery("#calendar_view_k").html(s)}else console.log("カレンダービュー：データ中に日付がありません。")}_callback(t,e){var i="";if(null!=t.ents){var a=t.ents;for(var r in a){var n=a[r],l=e._getNameField(n);i+="<div>"+e._xss_sanitize(n[l])+"</div>"}}return i="<div style='width:120px;height:80px'>"+i+"</div>"}_getNameField(t){if(null==this.name_field)for(var e in this.name_field="id",t)e.indexOf("name")>=0&&(this.name_field=e);return this.name_field}_xss_sanitize(t){if("object"==typeof t){for(var e in t)t[e]=_xss_sanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_buildCalendarViewHtml(t,e,i){var a=new Date(i),r="<table class='calendar_view_k'><caption>"+(a.getFullYear()+"-"+(a.getMonth()+1))+"</caption><thead><tr>",n=[{code:"sun",wamei:"日"},{code:"mon",wamei:"月"},{code:"tue",wamei:"火"},{code:"wed",wamei:"水"},{code:"thu",wamei:"木"},{code:"fri",wamei:"金"},{code:"sat",wamei:"土"}];for(var l in n){var s=n[l].wamei;r+="<th class='"+("cvk_"+(d=n[l].code))+"'>"+s+"</th>"}for(var l in r+="</tr></thead><tbody>",t){var o=t[l];for(var h in r+="<tr>",o){var d,_=o[h],c=new Date(h),p=c.getDate(),u="cvk_"+(d=n[c.getDay()].code);0==_.cur_month_flg&&(u="cvk_out_this_month"),r+="<td><div class='cvk_cell'><div class='cvk_cell_div1 "+u+"'>"+p+"</div><div class='cvk_cell_div2'> "+d+" </div><div class='cvk_cell_div3'>"+e(_,this)+"</div></div></td>"}r+="</tr>"}return r+="</tbody></table>"}_weekStructConv(t){var e=[],i=0,a=0;for(var r in t){var n=t[r];if(null==e[i]){if(i>=4&&0==n.cur_month_flg)return e;e[i]={}}e[i][r]=n,7==++a&&(i++,a=0)}return e}_mappingToCalData(t,e){for(var i in t)null!=e[i]&&(t[i].ents=e[i]);return t}_createCalendarDataFormat(t,e){var i=new Date(t),a=i.getFullYear(),r=i.getMonth(),n=i.getDay(),l=new Date(t);l.setDate(l.getDate()-n);for(var s=this._convDateToYMD(l),o={},h=new Date(s),d=0;d<42;d++){var _=0;h.getFullYear()==a&&h.getMonth()==r&&(_=1);var c=this._convDateToYMD(h);o[c]={index:d,date:c,cur_month_flg:_},h.setDate(h.getDate()+1)}return o}_shapingDateInData(t,e){for(var i in t){var a=t[i];a[e]=this._shapingDate(a[e])}return t}_getBaseMonthStart(t,e){for(var i in t){var a=t[i];if(null!=a[e]){var r=a[e];return r=this._getMonthStartDate(r)}}return null}_getMonthStartDate(t){return null==t?null:("string"==typeof t&&(t=new Date(t)),t.getFullYear()+"-"+(t.getMonth()+1)+"-1")}_getMonthEndDate(t){if(null==t)return null;"string"==typeof t&&(t=new Date(t));var e=new Date(t.getFullYear(),t.getMonth()+1,0);return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}_aggByDateField(t,e){var i={};for(var a in t){var r=t[a],n=r[e];null!=n&&(null==i[n]&&(i[n]=[]),i[n].push(r))}return i}_shapingDate(t){return null==t?null:("string"==typeof t&&(t=new Date(t)),t=this._convDateToYMD(t))}_convDateToYMD(t){return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}}class CbBtnSizeChanger{constructor(t,e){var i=(i=location.href).split(/[?#]/)[0];this.ls_key=i+"-CbBtnSizeChanger_1.1.4",this.param=this._setParamIfEmpty(t),this.iniCnfData=this._makeIniCnfData(e);var a=this._initCnfData(this.iniCnfData),r=this._createCnfFormHtml(a),n=jQuery(this.param.main_slt);n.html(r),this._setCheckEvent(n,a),this._setVisibleCbClickEvent(n,a),this._setSubEvents(n),1==this.param.save_flg&&(this._changeSizeAll(a),this._changeBtnVisibleAll(a)),this.mainForm=n,this.cnfData=a}_makeIniCnfData(t){var e=this._getDefaultCnfData();return jQuery.extend(e,t),e}_getDefaultCnfData(){var t=[{slt:".row_edit_btn",wamei:"編集ボタン",visible:!0,def_size:"btn-xs",size:"btn-xs"},{slt:".row_copy_btn",wamei:"複製ボタン",visible:!0,def_size:"btn-xs",size:"btn-xs"},{slt:".row_delete_btn",wamei:"削除ボタン",visible:!0,def_size:"btn-xs",size:"btn-xs"},{slt:".row_eliminate_btn",wamei:"抹消ボタン",visible:!1,def_size:"btn-xs",size:"btn-xs"},{slt:".row_exc_btn",wamei:"行入替ボタン(↑↓ボタン)",visible:!0,def_size:"btn-xs",size:"btn-xs"},{slt:".row_enabled_btn",wamei:"有効ボタン",visible:!1,def_size:"btn-xs",size:"btn-xs"}];for(var e in t){var i=t[e];i.code=this._getCodeFromSlt(i.slt)}return t}_setParamIfEmpty(t){return null==t&&(t={}),null==t.main_slt&&(t.main_slt="#CbBtnSizeChanger"),null==t.radioData&&(t.radioData=[{value:"btn-xs",wamei:" 極小"},{value:"btn-sm",wamei:" 小　"},{value:"",wamei:" 普通"},{value:"btn-lg",wamei:" 大　"}]),null==t.save_flg&&(t.save_flg=1),t}_initCnfData(t){var e=this._loadCnfData();return this._empty(e)&&(e=jQuery.extend(!0,{},t)),e}_getCodeFromSlt(t){var e=t,i=e.charAt(0);return"."!=i&&"#"!=i||(e=e.substr(1)),e}_createCnfFormHtml(t){var e="\n\t\t\t<div style='padding:10px;margin-bottom:10px;background-color:#8dbbf3;border-radius:5px;display:inline-block'>\n\t\t\t<table class='tbl2'><tbody>\n\t\t";for(var i in t){var a=t[i],r=this._createVisibleCbHtml(a,i),n=this._createRadiosHtml(a);e+=`\n\t\t\t<tr>\n\t\t\t\t<td>${a.wamei}</td>\n\t\t\t\t<td>${r}</td>\n\t\t\t\t<td>${n}</td>\n\t\t\t</tr>\n\t\t\t`}return e+="\n\t\t\t\t</tbody></table>\n\t\t\t\t<input id='cbbsc_def_btn' type='button' value='初期に戻す' class='btn btn-default btn-xs' >\n\t\t\t\t<input id='cbbsc_close_btn' type='button' value='閉じる' class='btn btn-default btn-xs' >\n\t\t\t</div>\n\t\t"}_createVisibleCbHtml(t,e){var i="";return 1==t.visible&&(i="checked"),`<label><input type='checkbox' class='cbsc_visible_cb' data-index='${e}' ${i}> 表示</label>`}_createRadiosHtml(t){var e="",i=this.param.radioData;for(var a in i){var r=i[a],n="";r.value==t.size&&(n="checked"),e+="<label class='btn btn-primary btn-sm'><input type='radio' name='"+("cbbsc_r_"+t.code)+"' value='"+r.value+"' "+n+" >"+r.wamei+"</label>"}return e="<div class='btn-group' >"+e+"</div>"}_setCheckEvent(t,e){for(var i in e){var a="cbbsc_r_"+e[i].code;t.find("[name='"+a+"']").click(t=>{this._checkEvent(t)})}}_checkEvent(t){var e=jQuery(t.target),i=e.attr("name"),a=e.val(),r=this._getCnfEntByName(i);r.size=a,jQuery(r.slt).each((t,e)=>{this._changeSize(e,a)}),1==this.param.save_flg&&this._saveCnfData()}_getCnfEntByName(t){var e=t.replace("cbbsc_r_","");for(var i in this.cnfData){var a=this.cnfData[i];if(a.code==e)return a}return null}_changeSize(t,e){t=jQuery(t);var i=this.param.radioData;for(var a in i){var r=i[a].value;if(""!=r&&t.hasClass(r)){if(e==r)return;t.removeClass(r)}}""!=e&&t.addClass(e)}_changeSizeAll(t){for(var e in t){var i=t[e];jQuery(i.slt).each((t,e)=>{this._changeSize(e,i.size)})}}_setVisibleCbClickEvent(t,e){for(var i in e){e[i];var a=`.cbsc_visible_cb[data-index='${i}']`;t.find(a).click(t=>{var e=jQuery(t.currentTarget);this.visibleCbClickEvent(e)})}}visibleCbClickEvent(t){var e=t.attr("data-index"),i=t.prop("checked"),a=this.cnfData[e];a.visible=i,this._changeBtnVisible(a),1==this.param.save_flg&&this._saveCnfData()}_changeBtnVisible(t){var e=t.visible;jQuery(t.slt).each((t,i)=>{i=jQuery(i),1==e?i.show():i.hide()})}_changeBtnVisibleAll(t){for(var e in t){var i=t[e];this._changeBtnVisible(i)}}_setSubEvents(t){t.find("#cbbsc_def_btn").click(t=>{this.clearReset()}),t.find("#cbbsc_close_btn").click(t=>{this.mainForm.hide()})}clearReset(){this.cnfData=jQuery.extend(!0,{},this.iniCnfData);var t=this.cnfData;this._changeSizeAll(t),this._changeBtnVisibleAll(t),this._setCnfDataToRadios(t),this._setCnfDataToVisibleCb(t),this._saveCnfData()}_setCnfDataToRadios(t){for(var e in t){var i=t[e],a="cbbsc_r_"+i.code,r=this.mainForm.find("[name='"+a+"'][value='"+i.size+"']");r[0]&&r.prop("checked",!0)}}_setCnfDataToVisibleCb(t){for(var e in t){var i=t[e],a=`.cbsc_visible_cb[data-index='${e}']`,r=this.mainForm.find(a);i.visible?r.prop("checked",!0):r.prop("checked",!1)}}_loadCnfData(){var t={},e=localStorage.getItem(this.ls_key);if(!this._empty(e))t=JSON.parse(e);return t}_saveCnfData(){var t=JSON.stringify(this.cnfData);localStorage.setItem(this.ls_key,t)}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}setCnfData(t){for(var e in this.iniCnfData=this._makeIniCnfData(t),this.iniCnfData){var i=this.iniCnfData[e];i.code=this._getCodeFromSlt(i.slt)}var a=this._loadCnfData();this._empty(a)&&this.clearReset()}}class CbFileUploadComponent{constructor(t,e){this.fileUploadK=this._factoryFileUploadK(t,e),this.fuIds=t,this.fields=this._fueIdsToFields(t),this.none_img_fp="img/icon/none.gif"}_fueIdsToFields(t){var e=[];for(var i in t){var a=t[i],r=this._fudIdToField(a);e.push(r)}return e=this._array_unique(e)}_fudIdToField(t){var e=t;if(null==t)return e;if(t.length<3)return e;var i=e.slice(-2);if("_n"==i||"_e"==i)e=e.substr(0,e.length-2);return e}_array_unique(t){return t.filter((function(t,e,i){return i.indexOf(t)===e}))}_factoryFileUploadK(t,e){var i=new FileUploadK({prog_slt:"#prog1",err_slt:"#err",valid_ext:"image",img_width:120,img_height:120});for(var a in t){var r=t[a];i.addEvent(r,e)}return i}addEvent(t,e){return this.fileUploadK.addEvent(t,e)}getFileParams(){return this.fileUploadK.getFileParams()}uploadByAjax(t,e,i){return this.fileUploadK.uploadByAjax(t,e,i)}getFileNames(t){return this.fileUploadK.getFileNames(t)}setFilePaths(t,e,i){return this.fileUploadK.setFilePaths(t,e,i)}setImageToTr(t,e){for(var i in this.fields){var a=this.fields[i],r=t.find("[for='"+a+"']");if(r[0]){var n=r.find("img");if(n[0]){var l=e[a];if(null==l||""==l)return n.attr("src",this.none_img_fp),void((s=r.find("a"))[0]&&s.attr("href",this.none_img_fp));var s,o=l,h=l.replace("/orig/","/thum/"),d=new Image;d.src=h,d.onload=()=>{n.attr("src",h)},(s=r.find("a"))[0]&&s.attr("href",o)}}}}setFilesToFd(t,e){var i=this.fileUploadK.box;for(var a in i){var r=this._getFieldInfoFromFuKey(a);if(r.form_type==e){var n=i[a].files;if(null!=n&&null!=n[0]){var l=i[a].fileData;if(null!=l[0])0==l[0].err_flg&&t.append(r.field,n[0])}}}return t}_getFieldInfoFromFuKey(t){var e={fu_id:t,field:t,form_type:"none"};if(null==t||""==t)return e;if(t.length<3)return e;var i=t.slice(-2);if("_n"==i)e.form_type="new_inp",e.field=t.substr(0,t.length-2);else{if("_e"!=i)return e;e.form_type="edit",e.field=t.substr(0,t.length-2)}return e}}
/**
 * Google翻訳API・キャッシュ機能拡張
 * 
 * @note
 * Google Transrate APIのキャッシュ機能付き拡張クラス
 * 
 * @date 2019-1-27 | 2019-2-2
 * @version 1.0.2
 * @licens MIT
 */class CbGtaCash{constructor(t){t=this._setParamIfEmpty(t),this.param=t,this.jaTextList={}}init(t,e,i){i&&jQuery.extend(this.param,i),i=this.param,this.xids=e,this.page_code=t;var a=this._getLangData();this.langData=a;var r=this._createSelectOptionHtml(a),n=jQuery(i.slt);n.html(r),n.change(t=>{var e=jQuery(t.currentTarget),i=e.val();""!=i&&(this.cashTransExe(this,i),this.param.changed_select_callback&&this.param.changed_select_callback(e))})}cashTransExe(t,e){var i=[];for(var a in t.xids){var r=t.xids[a];if(null==r||""==r)return;if(r=t._setSharp(r),null==t.jaTextList[r]){if(null==jQuery(r)[0])continue;t.jaTextList[r]=jQuery(r).html()}var n={lang:e,xid:r,ja_text:t.jaTextList[r]};i.push(n)}t._cashTransExeAjax(t.page_code,e,i)}_cashTransExeAjax(t,e,i){for(var a in i){var r=i[a];r.ja_text=r.ja_text.replace(/&/g,"%26")}var n={action_code:"get_cash",page_code:t,lang:e,data:i},l=JSON.stringify(n),s=this.param.ajax_url;jQuery.ajax({type:"POST",url:s,data:"key1="+l,cache:!1,dataType:"text"}).done((t,e)=>{var i;try{i=jQuery.parseJSON(t)}catch(e){return void jQuery("#err").append(t)}this._cashTrans(i)}).fail((t,e,i)=>{jQuery("#err").append("アクセスエラー"),jQuery("#err").append(t.responseText)})}_cashTrans(t){for(var e in jQuery(".cb_gta_cash_btn").hide(),t){var i=t[e];1==i.t_cash_flg?jQuery(i.xid).html(i.trans_text):this._createCbGtaCashBtn(i)}}_createCbGtaCashBtn(t){var e=this._getLangName(t.lang),i=jQuery(t.xid),a=i.find(".cb_gta_cash_btn");if(a[0])return a.val(e),a.attr("data-lang",t.lang),void a.show();var r=`<input type="button" value="${e}" \n\t\t\tclass="cb_gta_cash_btn btn btn-success btn-sm" data-xid="${t.xid}" data-lang="${t.lang}"/>`,n=i.find(".cb_gta_cash_wb");n[0]?n.html(r):(r="<div class='cb_gta_cash_wb'>"+r+"</div>",i.prepend(r)),(a=i.find(`[data-xid='${t.xid}']`)).click(t=>{var e=$(t.currentTarget);this.apiTranseAction(e)})}apiTranseAction(t){jQuery(".cb_gta_cash_btn").prop("disabled",!0);var e=t.attr("data-xid"),i=t.attr("data-lang"),a=this.jaTextList[e];a=a.replace(/&/g,"%26");var r={action_code:"api_transe",page_code:this.page_code,lang:i,xid:e,ja_text:a},n=JSON.stringify(r),l=this.param.ajax_url;jQuery.ajax({type:"POST",url:l,data:"key1="+n,cache:!1,dataType:"text"}).done((t,e)=>{var i;try{i=jQuery.parseJSON(t)}catch(e){return void jQuery("#err").append(t)}jQuery(i.xid).html(i.trans_text),setTimeout((function(){jQuery(".cb_gta_cash_btn").prop("disabled",!1)}),3e3)}).fail((t,e,i)=>{jQuery("#err").append("アクセスエラー"),jQuery("#err").append(t.responseText)})}_getLangName(t){var e="none",i=this.langData;for(var a in i){var r=i[a];if(r["iso639-1"]==t){e=r.lang_name;break}}return e}_setSharp(t){return"#"!=t.charAt(0)&&(t="#"+t),t}_createSelectOptionHtml(t){var e="<option value='' > -- Language -- </option>";for(var i in t){var a=t[i],r=a.wamei+"  "+a.lang_name;e+="<option value='"+a["iso639-1"]+"' >"+r+"</option>"}return e}_setParamIfEmpty(t){if(null==t.slt&&(t.slt="#cb_gta_cash"),null==t.ajax_url)throw new Error("Empty ajax_url !");return t}_getLangData(){var t=[{lang_nation:"インド・ヨーロッパ語族",wamei:"英語",lang_name:"English","iso639-1":"en","iso639-2T":"eng","iso639-2B":"eng","iso639-3":"eng","iso639-6":"engs",note:"",google_api:!0}],e=[];for(var i in t){var a=t[i];1==a.google_api&&e.push(a)}return e}}
/**
 * 列表示切替クラス 
 * 
 * 初期化(init)を実行すると、対象HTMLテーブルの列から、列表示切替チェックボックスを自動生成します。
 * 列表示切替チェックボックスにチェックを入れると列の表示を切り替えられます。
 * 
 * ◇主なメソッド
 * - init 初期化
 * - refresh 一覧テーブルをリフレッシュする
 * 
 * @version 1.6.0
 * @date 2014-4-1 │ 2019-8-28
 * @license MIT
 * @author k-uehara 
 */var ClmShowHide=function(){var t=this;function e(e,i,a){var r=$("#"+t.props.chBoxsId);for(var n in t.defClmData){var l=t.defClmData[n].show_flg,s=r.find("[index="+n+"]");s[0]&&(1==l?(s.prop("checked",!0),t.clm_show_csh(e,n)):0==l&&(s.prop("checked",!1),t.clm_hide_csh(e,n)))}localStorage.removeItem(a+"_clmData")}function i(){var e=$("#"+t.props.chBoxsId),i=t.actClmData;for(var a in i){var r=e.find("[index="+a+"]");if(r[0]){var n=r.prop("checked");i[a].show_flg=1==n?1:0}}return i}this.props={},this.defClmData={},this.actClmData={},this.init=function(a,r,n,l){this.props.tblId=a,this.props.chBoxsId=r,this.props.unique=l,null==l&&(l=a);for(var s=[],o=0;o<n.length;o++){var h={clm_name:null,show_flg:n[o]};s[o]=h}o=0;$.each($("#"+a+" thead tr th"),(function(){var t=$(this).html();try{s[o].clm_name=t}catch(t){return}o++}));var d=localStorage.getItem(l+"_clmData"),_={};for(var o in _=""==d||null==d?$.extend(!0,{},s):JSON.parse(d),this.defClmData=s,this.actClmData=_,_=function(t){for(let e in t){let i=t[e],a=i.clm_name;i.clm_name=a.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,"")}return t}(_),function(t,e,i){var a=$("#"+e);for(var r in a.empty(),i){var n=i[r];if(-1==n.show_flg)continue;var l="";1==n.show_flg&&(l="checked");let t="csh_cb"+r;var s="<div class='csh_cb_div'><input id='"+t+"' type='checkbox' class='csh_cb' "+l+" index='"+r+"' /><label for='"+t+"'>"+n.clm_name+"</label></div>";a.append(s)}a.append("<div style='clear:both'></div>");var o="<div class='csh_func_btn'><input type='button' value='列表示を保存' id='"+t+"_save_btn' class='btn btn-primary btn-xs' /></div>";a.append(o);var h="<div class='csh_func_btn'><input type='button' value='すべてチェック' id='"+t+"_all_checked_btn' class='btn btn-primary btn-xs' /></div>";a.append(h);var d="<div class='csh_func_btn'><input type='button' value='すべてはずす' id='"+t+"_all_uncheck_btn' class='btn btn-primary btn-xs' /></div>";a.append(d);var _="<div class='csh_func_btn'><input type='button' value='初期に戻す' id='"+t+"_default_btn' class='btn btn-primary btn-xs' /></div>";a.append(_),a.append("<div id='csh_msg' class='csh_func_btn' style='display:none;color:#de5246'>列の表示状態を記憶しました。</div>")}(a,r,_),$(".csh_cb").click((function(e){var i=$(this).prop("checked"),r=$(this).attr("index");1==i?t.clm_show_csh(a,r):t.clm_hide_csh(a,r)})),_){0==(h=_[o]).show_flg&&this.clm_hide_csh(a,o)}$("#"+a+"_save_btn").click((function(t){!function(t,e,a){var r=i(),n=JSON.stringify(r);localStorage.setItem(a+"_clmData",n),$("#csh_msg").show(),$("#csh_msg").fadeOut(3e3)}(0,0,l)})),$("#"+a+"_all_checked_btn").click((function(e){!function(e,i,a){var r=$("#"+t.props.chBoxsId);for(var n in a){var l=r.find("[index="+n+"]");if(l[0])0==l.prop("checked")&&(l.prop("checked",!0),t.clm_show_csh(e,n))}}(a,0,t.actClmData)})),$("#"+a+"_all_uncheck_btn").click((function(e){!function(e,i,a){var r=$("#"+t.props.chBoxsId);for(var n in a){var l=r.find("[index="+n+"]");if(l[0])1==l.prop("checked")&&(l.prop("checked",!1),t.clm_hide_csh(e,n))}}(a,0,t.actClmData)})),$("#"+a+"_default_btn").click((function(t){e(a,r,l)}))},this.getCshAry=function(){var e=$("#"+t.props.chBoxsId),i=[];for(var a in this.defClmData){var r=e.find("[index="+a+"]");if(r[0])1==r.prop("checked")?i.push(1):i.push(0)}return i},this.reset=function(){e(this.props.tblId,this.props.chBoxsId,this.props.unique)},this.refresh=function(){var t=this.props.tblId;for(var e in this.defClmData)this.clm_show_csh(t,e);var a=i();for(var e in a){var r=a[e].show_flg;1==r?this.clm_show_csh(t,e):0==r&&this.clm_hide_csh(t,e)}},this.clm_show_csh=function(t,e){$("#"+t+" thead tr th").eq(e).show(),$.each($("#"+t+" tbody tr"),(function(){$(this).children().eq(e).show()}))},this.clm_hide_csh=function(t,e){$("#"+t+" thead tr th").eq(e).hide(),$.each($("#"+t+" tbody tr"),(function(){$(this).children().eq(e).hide()}))}};
/**
 * CrudBase.js
 * 
 * @note
 * CRUDのベース。
 * デフォルトでは、削除、編集、新規追加するたびにAjax通信を行う仕様である。
 * 削除、編集、新規追加するたびに更新するのが重い場合、適用ボタンで一括適用するモードも備える。
 * 
 * 
 * @license MIT
 * @date 2016-9-21 | 2019-10-13
 * @version 3.0.4
 * @histroy
 * 2019-6-28 v2.8.3 CSVフィールドデータ補助クラス | CsvFieldDataSupport.js
 * 2018-10-21 v2.8.0 ボタンサイズ変更機能にボタン表示切替機能を追加
 * 2018-10-21 v2.6.0 フォームをアコーディオン形式にする。
 * 2018-10-2 v2.5.0 フォームドラッグとリサイズ
 * 2018-9-18 v2.4.4 フォームフィット機能を追加
 * v2.0 CrudBase.jsに名称変更、およびES6に対応（IE11は非対応）
 * v1.7 WordPressに対応
 * 2016-9-21 v1.0.0
 * 
 * @param object param
 *  - src_code	画面コード（スネーク記法）
 *  - src_code_c	画面コード（キャメル記法）
 *  - tbl_slt	CRUD対象テーブルセレクタ
 *  - edit_form_slt	編集フォームセレクタ
 *  - new_form_slt	新規フォームセレクタ
 *  - delete_form_slt	削除フォームセレクタ
 *  - contents_slt	コンテンツセレクタ	コンテンツ全体を表すセレクタでフォームの位置調整で利用する。省略時すると画面windowを基準に位置調整する。
 *  - edit_reg_url	編集登録サーバーURL
 *  - new_reg_url	新規登録サーバーURL
 *  - delete_reg_url	削除登録サーバーURL
 *  - auto_save_url	自動保存サーバーURL
 *  - form_position	フォーム位置 auto:自動, left:左側表示, center:中央表示, right:右側表示,max:横幅いっぱい
 *  - form_width	フォーム横幅	数値で指定。未指定（null)である場合、autoと同様になる。ただしform_positionがmaxなら横幅最大になる。
 *  - form_height	フォーム縦幅	上記と同じ
 *  - form_z_index	重なり順序(cssのz-indexと同じ)
 *  - valid_msg_slt	バリデーションメッセージセレクタ
 *  - auto_close_flg	自動閉フラグ	0:自動で閉じない（デフォルト）  1:フォームの外側をクリックすると自動的に閉じる
 *  - ni_tr_place	新規入力追加場所フラグ 0:末尾(デフォルト） , 1:先頭
 *  - drag_and_resize_flg フォームドラッグとリサイズのフラグ 0:OFF , 1:ON(デフォルト)
 *  - form_mode フォームモード 0:ダイアログモード , 1:アコーディオンモード(デフォルト）
 *  - midway_dp リソース配置先用の中間ディレクトリパス
 *  - configData CrudBaseConfigの設定データ
 *  
 *  @param array fieldData フィールドデータ（フィールド名の配列。フィード名の順番は列並びと一致していること）
 */class CrudBase{constructor(t,e){this.param=this._setParamIfEmpty(t),this.formInfo=this._initFormInfo(this.param),this.fieldData=this._addMoreFieldData(this.param.tbl_slt,this.fieldData),this.fieldData=this._setFieldDataFromForm(this.fieldData,this.formInfo,"new_inp"),this.fieldData=this._setFieldDataFromForm(this.fieldData,this.formInfo,"edit"),this.fieldData=this._setFieldDataFromForm(this.fieldData,this.formInfo,"delete");var i=this.getForm("edit"),a=this.getForm("new_inp");this.fieldHashTable=this._createFieldHashTable(this.fieldData),this.defNiEnt=this._getEntByForm("new_inp"),this.tbl=jQuery("#"+this.param.tbl_slt),this.crudBaseConfig=this._factoryCrudBaseConfig(this.param.configData),this.cbBtnSizeChanger=this.crudBaseConfig.cbBtnSizeChanger,this.autoSave=this._factoryCrudBaseAutoSave(),this.rowExchange=this._factoryCrudBaseRowExchange(),this.csh=this._factoryClmShowHide(),this.cbFileUploadComp=this._factoryCbFileUploadComponent(),this.datepickerWrap=this._factoryDatepickerWrap(),this.calendarViewK=this._factoryCalendarViewK(),this.crudBaseReact=this._factoryCrudBaseReact(),this.crudBaseBulkAdd=new CrudBaseBulkAdd(this.fieldData),this.crudBasePasswordEdit=new CrudBasePasswordEdit(a,i),this.cbGtaCash=new CbGtaCash({slt:"#cb_gta_cash",ajax_url:"cb_gta_cash"}),this.csvFieldDataSupport=new CsvFieldDataSupport,(new PagenationJump).init(),(new PagenationJump).init({xid:"pagenation_jump_b"}),(new RangeYmEx).init(),this.fueIdCash,this.foldingTaE=new FoldingTa,this.foldingTaE.init({form_slt:"#ajax_crud_edit_form"}),this.foldingTaN=new FoldingTa,this.foldingTaN.init({form_slt:"#ajax_crud_new_inp_form"}),"sp"==this.param.device_type&&this.tableTransform(1),this._formDragAndResizeSetting(),this._errByErrTypes(),this.actEditForm,this.activeTr,this.hiddensElm,this.formKjsElm,this._iniRtnSetUrl(),this._addEventForKjsEnter()}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.src_code)throw new Exception("'src_code' is empty!");if(null==t.src_code_c&&(t.src_code_c=this._snakeToCamel(t.src_code)),null==t.tbl_slt&&(t.tbl_slt=t.src_code+"_tbl"),null==t.edit_form_slt&&(t.edit_form_slt="ajax_crud_edit_form"),null==t.new_form_slt&&(t.new_form_slt="ajax_crud_new_inp_form"),null==t.delete_form_slt&&(t.delete_form_slt="ajax_crud_delete_form"),null==t.eliminate_form_slt&&(t.eliminate_form_slt="ajax_crud_eliminate_form"),null==t.contents_slt&&(t.contents_slt=null),null==t.edit_reg_url&&(t.edit_reg_url=t.src_code+"/ajax_reg"),null==t.new_reg_url&&(t.new_reg_url=t.src_code+"/ajax_reg"),null==t.delete_reg_url&&(t.delete_reg_url=t.src_code+"/ajax_delete"),null==t.auto_save_url&&(t.auto_save_url=t.src_code+"/auto_save"),null==t.file_uploads&&(t.file_uploads=null),null==t.form_width&&(t.form_width=null),null==t.form_height&&(t.form_height=null),null==t.form_position&&(t.form_position="auto"),null==t.form_z_index&&(t.form_z_index=9),null==t.valid_msg_slt&&(t.valid_msg_slt=".err"),null==t.auto_close_flg&&(t.auto_close_flg=0),null==t.ni_tr_place&&(t.ni_tr_place=0),null==t.disFilData&&(t.disFilData=null),null==t.kjs&&(t.kjs=null),null==t.device_type&&(t.device_type=this.judgDeviceType()),null==t.errTypes){var e=jQuery("#err_types_json").val();t.errTypes=jQuery.parseJSON(e)}return null==t.drag_and_resize_flg&&(t.drag_and_resize_flg=1),null==t.form_mode&&(t.form_mode=1),null==t.midway_dp&&(t.midway_dp=""),null==t.configData&&(t.configData={}),t}_factoryCrudBaseConfig(t){let e=new CrudBaseConfig;return e.init(null,t),e}_factoryCrudBaseAutoSave(){var t=typeof CrudBaseAutoSave;return null==t||"undefined"==t?{saveRequest:function(){}}:new CrudBaseAutoSave(this)}_factoryCrudBaseRowExchange(){var t,e=typeof CrudBaseRowExchange;if(null==e||"undefined"==e)return t={showForm:function(){}};t=new CrudBaseRowExchange(this,null,()=>{this.rowExchangeAfter()});var i=jQuery("#row_exc_flg").val();return this.rowExcBtnShow(i),t}_factoryClmShowHide(){var t,e=typeof ClmShowHide;if(null==e||"undefined"==e)return t={};t=new ClmShowHide;var i=jQuery("#csh_json").val(),a=JSON.parse(i),r="rkt_"+this.param.src_code+"_index";return t.init(this.param.tbl_slt,"clm_cbs",a,r),t}_factoryCbFileUploadComponent(){var t=typeof CbFileUploadComponent;if(null==t||"undefined"==t)return{addEvent:function(){},getFileParams:function(){},uploadByAjax:function(){},getFileNames:function(){},setFilePaths:function(){}};var e=this._getFueIds("new_inp"),i=this._getFueIds("edit"),a=e.concat(i),r={pacb:this._fukPrevAfterCallback,pacb_param:{self:this}};return new CbFileUploadComponent(a,r)}_factoryDatepickerWrap(){var t=typeof DatepickerWrap;return null==t||"undefined"==t?{tukishomatu:function(){}}:new DatepickerWrap(this)}_factoryCalendarViewK(){var t=typeof CalendarViewK;return null==t||"undefined"==t?{create:function(){}}:new CalendarViewK}_factoryCrudBaseReact(){var t=typeof CrudBaseReact;return null==t||"undefined"==t?{init:function(){},reactivatingOfRow:function(){}}:new CrudBaseReact}_getFueIds(t,e){if(null==e&&(e={}),null==e.cash_flg&&(e.cash_flg=1),1==e.cash_flg&&this.fueIdCash&&null!=this.fueIdCash[t])return this.fueIdCash[t];var i=[];for(var a in this.fieldData){var r=this.fieldData[a],n="inp_"+t;if(null!=r[n]){var l=r[n];if(null!=l.type_name&&"file"==l.type_name&&null!=l.elm){var s=l.elm.attr("id");i.push(s)}}}return null==this.fueIdCash&&(this.fueIdCash={}),this.fueIdCash[t]=i,i}newInpShow(t,e,i){null==e&&(e={}),"add_to_top"==e.ni_tr_place?this.param.ni_tr_place=1:"add_to_bottom"==e.ni_tr_place&&(this.param.ni_tr_place=0),this.formInfo.new_inp.show_flg=1,this.setFieldsToForm("new_inp",this.defNiEnt);var a=this.getForm("new_inp");(this.setValueToFrom(a,"form_type","new_inp"),this._clearValidErr(a),i)&&i({form:a});if(1==this.param.form_mode){var r=(a=this._setColspanToForm(a)).find("td");if("sp"==this.param.device_type)r.attr("colspan",1),r.css("display","block"),a.css("display","block");else{var n=this._getClmCntByActive();r.attr("colspan",n),r.css("display","table-cell"),a.css("display","table-row")}if("add_to_top"==e.ni_tr_place){var l=this.tbl.find("tbody tr").eq(0);a.insertBefore(l)}else if("add_to_bottom"==e.ni_tr_place){var s=this.tbl.find("tbody tr").eq(-1);a.insertAfter(s)}else r.css("display","block"),a.css("display","block"),a.insertAfter("#new_inp_form_point")}else this._showForm(a,t,e);this.crudBasePasswordEdit.showForm("new_inp"),this.foldingTaN.reflection()}editShow(t,e,i){null==e&&(e={});var a=jQuery(t).parents("tr");this.activeTr=a,this.formInfo.edit.show_flg=1;var r=this.getEntityByTr(a);this.setFieldsToForm("edit",r,e);var n=this.getForm("edit");n.show(),this._clearValidErr(n),i&&i(a,n,r),1==this.param.form_mode?(n=this._setColspanToForm(n)).insertAfter(a):this._showForm(n,t,e),this.crudBasePasswordEdit.showForm("edit"),this.foldingTaE.reflection()}copyShow(t,e,i){var a=jQuery(t).parents("tr");this.activeTr=a,this.formInfo.new_inp.show_flg=1;var r=this.getEntityByTr(a),n=this.getForm("copy");this.setValueToFrom(n,"form_type","copy");var l=a.index();if(this.setValueToFrom(n,"row_index",l),this.setFieldsToForm("new_inp",r,e),this._clearValidErr(n),i&&i(a,n,r),1==this.param.form_mode){var s=(n=this._setColspanToForm(n)).find("td");if("sp"==this.param.device_type)s.attr("colspan",1),s.css("display","block"),n.css("display","block");else{var o=this._getClmCntByActive();s.attr("colspan",o),s.css("display","table-cell"),n.css("display","table-row")}n.insertAfter(a)}else this._showForm(n,t,e);this.crudBasePasswordEdit.showForm("copy")}deleteAction(t,e){if(1!=this.crudBaseConfig.data.delete_alert_flg||window.confirm("削除しますがよろしいですか？")){t instanceof jQuery||(t=jQuery(t)),null==e&&(e={}),null==e.form_show_flg&&(e.form_show_flg=0);var i=t.parents("tr");this.activeTr=i,1==e.form_show_flg?(e.tr=i,this.deleteShow(t,e)):(e.caller_type=1,this.deleteReg(e))}}enabledAction(t,e){t instanceof jQuery||(t=jQuery(t)),null==e&&(e={});var i=t.parents("tr");this.activeTr=i,this.enabledReg(e)}eliminateShow(t,e,i){t instanceof jQuery||(t=jQuery(t));var a=t.parents("tr");this.activeTr=a;var r=this.formInfo.eliminate;r.show_flg=1;var n=this.getEntityByTr(a),l=jQuery(r.slt);this.setFieldsToForm("eliminate",n,e),i&&i(a,l,n),this._showForm(l,t,e)}newInpReg(t,e,i){var a=this.getForm("new_inp");if(0!=this._validationCheckForm("new_inp")){this._empty(i)&&(i={}),this._toggleRegBtn("new_inp",0);var r=new FormData;r=this.cbFileUploadComp.setFilesToFd(r,"new_inp");var n=this._getEntByForm("new_inp"),l=!1;if(this._empty(n.id)||(l=!0),t){var s=t(n,r);if(s.err)return void this._errShow(s.err,"new_inp");s.ent?(n=s.ent,r=s.fd):n=s}var o=JSON.stringify(n);r.append("key1",o);var h={};i.wp_action&&(h.action=i.wp_action,i.wp_nonce&&(h.nonce=i.wp_nonce));var d=this.getValueFromForm(a,"form_type");h.form_type=d,h.ni_tr_place=this.param.ni_tr_place;var _=JSON.stringify(h);r.append("reg_param_json",_);var c=this._decAddRowIndex(a,d,i);jQuery.ajax({type:"post",url:this.param.new_reg_url,data:r,cache:!1,dataType:"text",processData:!1,contentType:!1}).done((t,i)=>{var a;this._toggleRegBtn("new_inp",1);try{a=jQuery.parseJSON(t)}catch(e){return alert("エラー"),void jQuery("#err").html(t)}if(a.err)this._showErrToForm(a.err,"new_inp");else{1==l&&location.reload(!0),this.closeForm("new_inp");var r=this._addTr(a,c);this._switchBtnsDisplay(r,a),null!=e&&window.setTimeout(()=>{e(a)},1)}}).fail((t,e,i)=>{this._toggleRegBtn("new_inp",1),jQuery("#err").html(t.responseText),alert(e)})}}editReg(t,e,i){if(0!=this._validationCheckForm("edit")){this._empty(i)&&(i={}),this._toggleRegBtn("edit",0);var a=this._getEntByForm("edit"),r=new FormData;if(r=this.cbFileUploadComp.setFilesToFd(r,"edit"),t){var n=t(a,r);if(n.err)return void this._errShow(n.err,"edit");n.ent?(a=n.ent,r=n.fd):a=n}var l={},s=JSON.stringify(a);r.append("key1",s),i.wp_action&&(l.action=i.wp_action,i.wp_nonce&&(l.nonce=i.wp_nonce)),l.form_type="edit";var o=JSON.stringify(l);r.append("reg_param_json",o),jQuery.ajax({type:"post",url:this.param.edit_reg_url,data:r,cache:!1,dataType:"text",processData:!1,contentType:!1}).done((t,i)=>{this._toggleRegBtn("edit",1);var a=null;try{a=jQuery.parseJSON(t)}catch(e){alert("エラー:"+t),console.log(t),jQuery("#err").html(t)}if(a){if(a.err)return void this._showErrToForm(a.err,"edit");var r=this._getTrInEditing();0==this.param.kj_delete_flg&&1==a.delete_flg&&r.hide(),a.id!=r.find(".id").text()&&location.reload(!0),this._setEntityToEditTr(a,r),null!=e&&window.setTimeout(()=>{e(a)},1),1!=this._getKjs().kj_delete_flg&&1==a.delete_flg?r.css("background-color","#808080"):r.css("background-color","#d7e6fd"),this.closeForm("edit")}}).fail((t,e,i)=>{this._toggleRegBtn("edit",1),jQuery("#err").html(t.responseText),alert(e)})}}deleteRegByRowIndex(t,e){var i=this.getEntity(t);this._deleteRegBase(i,1,e)}eliminateReg(t){null==t&&(t={});var e=this._getEntByForm("eliminate");t.eliminate_flg=1;this._deleteRegBase(e,1,t)}closeForm(t){var e=this.formInfo[t].form;jQuery("#crud_base_forms").append(e),e.hide()}rowExchangeShowForm(t){this.rowExchange.showForm(t)}rowExcBtnShow(t){1==t?jQuery(".row_exc_btn").show():jQuery(".row_exc_btn").hide()}resetKjs(t){null==t&&(t=[]);var e=$("#def_kjs_json").val(),i=jQuery.parseJSON(e);for(var a in i)t.indexOf(a)<0&&$("#"+a).val(i[a]);this.cbGadgetKj.reset()}getContainer(){return{param:this.param,fieldData:this.fieldData,fieldHashTable:this.fieldHashTable,formInfo:this.formInfo,defNiEnt:this.defNiEnt,formNewInp:this.formNewInp,formEdit:this.formEdit,formDelete:this.formDelete,showFormStrategy:this.showFormStrategy,react:this.react}}getTblRowCount(){return jQuery("#"+this.param.tbl_slt).children("tbody").children("tr").length}_decAddRowIndex(t,e,i){if(null!=i.add_row_index)return i.add_row_index;var a=-1;return 1==this.param.ni_tr_place&&(a=0),"copy"==e&&(a=this.getValueFromForm(t,"row_index"),a*=1,a++),a}deleteShow(t,e){t instanceof jQuery||(t=jQuery(t));var i=e.tr;null==i&&(i=jQuery(t).parents("tr"));var a=this.formInfo.delete;a.show_flg=1;var r=this.getEntityByTr(i),n=jQuery(a.slt);this.setFieldsToForm("delete",r,e);var l=e.cbBeforeFormShow;l&&l(i,n,r),this._showForm(n,t,e)}deleteReg(t){var e;null==t&&(t={}),null==t.caller_type&&(t.caller_type=0),e=0==t.caller_type?this._getEntByForm("delete"):this.getEntity();this._deleteRegBase(e,1,t)}enabledReg(t){null==t&&(t={});var e=this.getEntity();this._deleteRegBase(e,0,t)}_deleteRegBase(t,e,i){if(!t.id)throw new Error("Not id");var a=0;i.eliminate_flg&&(a=i.eliminate_flg);var r="delete";a&&(r="eliminate"),t.delete_flg=e,null==i&&(i={});var n=new FormData,l={};l.form_type=r,i.wp_action&&(l.action=i.wp_action,i.wp_nonce&&(l.nonce=i.wp_nonce)),a&&(l.eliminate_flg=a);var s=JSON.stringify(l);n.append("reg_param_json",s);var o=i.cbBeforeReg;if(o){var h=o(t,n);if(h.err)return void this._errShow(h.err,r);h.ent?(t=h.ent,n=h.fd):t=h}var d=JSON.stringify(t);n.append("key1",d),jQuery.ajax({type:"post",url:this.param.delete_reg_url,data:n,cache:!1,dataType:"text",processData:!1,contentType:!1}).done((t,e)=>{var n;try{n=jQuery.parseJSON(t)}catch(e){alert("エラー"),jQuery("#err").html(t)}if(n){if(0===this.param.kjs.kj_delete_flg||"0"===this.param.kjs.kj_delete_flg||1==a)this.activeTr.remove();else{var l=this._getTrInEditing();this._setEntityToEditTr(n,l)}var s=i.cbAfterReg;s&&window.setTimeout(()=>{s(n)},1),this.closeForm(r)}}).fail((t,e,i)=>{jQuery("#err").html(t.responseText),alert(e)})}getTr(t){if(null==t)return this.activeTr;var e="#"+this.param.tbl_slt+" tbody tr";return jQuery(e).eq(t)}getLastTr(){var t="#"+this.param.tbl_slt+" tbody tr";return jQuery(t).eq(-1)}_getTrInEditing(){return this.activeTr}getTd(t,e){var i=this.getTr(t).find("."+e);return i[0]?i.parents("td"):null}getTdInEditing(t){var e=this._getTrInEditing().find("."+t);return e[0]?e.parents("td"):null}getEntity(t){var e=this.getTr(t);return this.getEntityByTr(e)}getEntityByTr(t){var e={};for(var i in this.fieldData){var a=this.fieldData[i].field,r=t.find("[name='"+a+"']");e[a]=r.val()}return e}getEntityByInnerElm(t){var e=jQuery(t).parents("tr").index();return this.getEntity(e)}getDataFromTbl(t){null==t&&(t=this.tbl),t instanceof jQuery||(t=jQuery(t));var e=t.find("tbody tr"),i=[];return e.each((t,e)=>{var a=jQuery(e),r=this.getEntityByTr(a);i.push(r)}),i}getDataFromTblByFields(t){var e="#"+this.param.tbl_slt+" tbody tr",i=[];return jQuery(e).each((e,a)=>{var r=jQuery(a),n={};for(var e in t){var l=t[e];a=r.find("."+l);n[l]=this._getValueEx(a)}i.push(n)}),i}_getValueEx(t){var e=t.prop("tagName");return"INPUT"==e||"SELECT"==e||"TEXTAREA"==e?t.val():t.html()}getValueFromForm(t,e){var i=this._formFind(t,e),a=null;return i[0]&&(a=this._getValueEx(i)),a}setValueToFrom(t,e,i){var a=this._formFind(t,e);a[0]&&this._setValueEx(a,i)}_showErrToForm(t,e){var i=t;Array.isArray(i)&&(i=i.join("<br>"));var a=this.formInfo[e];jQuery(a.slt).find(".err").html(i)}_clearValidErr(t){var e=t.find(this.param.valid_msg_slt);for(var i in e.html(""),this.fieldData){var a=this.fieldData[i].field,r=t.find("[for='"+a+"']");r[0]&&(r.html(""),r.hide())}}_validationCheckForm(t){var e=!0,i=this.formInfo[t];return jQuery(i.slt).find(".valid").each((t,i)=>{i=jQuery(i);var a=this._getFieldByNameOrClass(i);0==this._validationCheck(i,a)&&(e=!1)}),e}_validationCheck(t,e){var i=!0,a=jQuery("[for='"+e+"']"),r=t.attr("title");try{1==(i=t[0].checkValidity())?(a.attr("class","text-success"),a.html("")):(a.attr("class","text-danger"),a.html(r),a.show())}catch(t){throw t}return i}_resetFileUpload(t){t.evt=null;var e=t.elm;try{e.val("")}catch(t){console.log("It can not be reset in IE ")}var i=jQuery("#"+t.preview_slt);return i.attr("src",""),i.hide(),t}addTr(t,e,i){this._addTr(t,e,i)}_addTr(t,e,i){null==e&&(e=-1),e*=1,i||(i={});var a="#"+this.param.tbl_slt,r=jQuery(a+" tbody tr");0==r.length&&location.reload(!0);var n="<tr style='background-color:#fdeaea'>"+r.eq(0).html()+"</tr>",l=this._insertTr(a,e,n);return i.form_type="new_inp",this.setEntityToTr(l,t,i),l}_insertTr(t,e,i){var a=jQuery(t+" tbody"),r=a.find("tr"),n=r.length,l=null;if(n>0)if(e<n&&e>-1){var s=r[e];jQuery(s).before(i),l=e}else{s=r[n-1];jQuery(s).after(i),l=n}else a.append(i),l=0;var o=(r=a.find("tr"))[l];return jQuery(o)}_setEntityToEditTr(t,e,i){if(null!=t){if(i||(i={}),null==e)e=this._getTrInEditing();i.form_type="edit",this.setEntityToTr(e,t,i),this._switchBtnsDisplay(e,t)}}_switchBtnsDisplay(t,e){1==e.delete_flg?(this._switchBtnDisp(t,".row_delete_btn",0),this._switchBtnDisp(t,".row_enabled_btn",1),this._switchBtnDisp(t,".row_eliminate_btn",1)):(this._switchBtnDisp(t,".row_delete_btn",1),this._switchBtnDisp(t,".row_enabled_btn",0),this._switchBtnDisp(t,".row_eliminate_btn",0))}_switchBtnDisp(t,e,i){var a=t.find(e);a[0]&&(i?a.show():a.hide())}setDataToTbl(t,e,i){null==t&&(t=this.tbl),t.find("tbody tr").each((t,a)=>{if(null!=e[t]){a=jQuery(a);var r=e[t];this.setEntityToTr(a,r,i)}})}setEntityToTr(t,e,i){if(null!=e){null==i&&(i={});var a=1;null!=i.xss_flg&&(a=i.xss_flg),1==a&&(e=this._xssSanitaizeEncode(e)),this.entToBinds(t,e,"class",i),this.entToBinds(t,e,"name",i)}}_nl2brEx(t){return null==t||""==t||"0"==t?t:"string"!=typeof t?t:t=t.replace(/\r\n|\n\r|\r|\n/g,"<br>")}_getEntByForm(t){var e=this._getTrInEditing(),i={},a=this.getForm(t);"edit"!=t&&"delete"!=t||(i=this.getEntityByTr(e));var r={};for(var n in this.fieldData){var l=this.fieldData[n].field,s=this._formFind(a,l),o=s.length,h=null;0!=o&&(1==o?h=this._getEntByForm2(s,a,l):s.each((t,e)=>{var i=jQuery(e);h=this._getEntByForm2(i,a,l)}),r[l]=h)}return jQuery.extend(i,r),i}getForm(t,e){var i;if(null==e&&(e=1),"new_inp"==t||"copy"==t)i=1==e&&null!=this.formNewInp?this.formNewInp:jQuery("#"+this.param.new_form_slt),this.formNewInp=i;else if("edit"==t)i=1==e&&null!=this.formEdit?this.formEdit:jQuery("#"+this.param.edit_form_slt),this.formEdit=i;else if("delete"==t)i=1==e&&null!=this.formDelete?this.formDelete:jQuery("#"+this.param.delete_form_slt),this.formDelete=i;else{if("eliminate"!=t)throw new Error("Uknown form_type!");i=1==e&&null!=this.formEliminate?this.formEliminate:jQuery("#"+this.param.eliminate_form_slt),this.formEliminate=i}return i}_getEntByForm2(t,e,i){var a=t.get(0).tagName,r=t.attr("data-inp-ex");if(r)switch(r){case"image1":case"image_fuk":return t.attr("data-fp")}var n=null;if("INPUT"==a||"SELECT"==a||"TEXTAREA"==a){var l=t.attr("type");if("file"==l){var s=t.attr("id");if(this.cbFileUploadComp){var o=this.cbFileUploadComp.getFileNames(s);null!=o[0]&&(n=o[0])}}else if("checkbox"==l)n=0,t.prop("checked")&&(n=1);else if("radio"==l){var h=e.find("[name='"+i+"']:checked");n=0,h[0]&&(n=h.val())}else n=t.val()}else n="IMG"==a?this._getValFromLabel(e,i):t.html();return n}_getValFromLabel(t,e){var i=null,a=t.find("[for='"+e+"']");return a[0]&&(i=a.html()),i}_formFind(t,e){var i=t.find("[name='"+e+"']");return null==i[0]&&(i=t.find("."+e)),i}_convertFormToDlg(t,e){var i=this.param;null==e&&(e=i.form_z_index);var a=t.form,r={"z-index":e,position:"absolute"};a.css(r),1==this.param.auto_close_flg&&(jQuery(document).click(()=>{1==t.show_flg?t.show_flg=0:jQuery(t.slt).hide()}),a.click(t=>{t.stopPropagation()})),a.hide()}judgDeviceType(){var t="pc";return screen.width<=480&&(t="sp"),t}_setFieldDataFromForm(t,e,i){var a=e[i].form;for(var r in t){var n=t[r],l=n.field,s={elm:null,tag_name:null,type_name:null,accept:""},o=this._formFind(a,l);if(s.elm=o,null!=o[0]){var h=o.get(0).tagName;s.tag_name=h;if("INPUT"==h||"SELECT"==h||"TEXTAREA"==h){var d=o.attr("type");if(s.type_name=d,"file"==d){var _=o.attr("accept");s.accept=_}}n["inp_"+i]=s}}return t}trToDiv(t,e,i){var a=this.getEntity(e);this.entToBinds(t,a,"class",i),this.entToBinds(t,a,"name",i)}entToBinds(t,e,i,a){var r=this.getBindElms(t,i,a);for(var n in a||(a={}),"class"==i?a.dis_fil_flg=1:"name"==i&&(a.dis_fil_flg=0),this.fieldData){var l=this.fieldData[n].field;if(void 0!==e[l]){var s=r[l];for(var o in s){var h=s[o];this.setValueToElement(h,l,e[l],e,a)}}}}getBindElms(t,e){var i={};for(var a in t instanceof jQuery||(t=jQuery(t)),this.fieldData){var r,n=this.fieldData[a];if("class"==e)r=t.find("."+n.field);else{if("name"!=e)continue;r=t.find(`[name='${n.field}']`)}if(r[0]){for(var l=[],s=0;s<r.length;s++)l.push(r.eq(s));i[n.field]=l}}return i}setFieldsToForm(t,e,i){var a=this.getForm(t);null==i&&(i={}),i.par=a,i.form_type=t,this.entToBinds(a,e,"class",i),this.entToBinds(a,e,"name",i)}setValueToElement(t,e,i,a,r){t instanceof jQuery||(t=jQuery(t)),null==r&&(r={});var n=0;n=null==r.xss?1:r.xss;var l=t.get(0).tagName;if(r.dis_fil_flg){var s=this.displayFilter(i,e,r.disFilData,n);i=s.val1,n=s.xss}var o=t.attr("data-inp-ex");if(o)switch(o){case"image1":this._setEntToImage1(t,e,i);break;case"image_fuk":this._setEntToImageFuk(t,e,i)}else if("INPUT"==l||"SELECT"==l){var h=t.attr("type");if("checkbox"==h)0==i||null==i||""==i?t.prop("checked",!1):t.prop("checked",!0);else if("radio"==h){var d=r.par.find("[name='"+e+"'][value='"+i+"']");if(d[0])d.prop("checked",!0);else if(this._empty(i))r.par.find("[name='"+e+"']").prop("checked",!1)}else this._setForCustumType(t,e,i,a,r)}else"TEXTAREA"==l?(""!=i&&null!=i&&(i=i.replace(/<br>/g,"\r"),i=this._xssSanitaizeDecode(i)),t.val(i)):("string"==typeof i&&(i=i.replace(/<br>/g,"\r"),1==r.xss&&(i=this._xssSanitaizeEncode(i)),i=this._nl2brEx(i)),t.html(i))}_setForCustumType(t,e,i,a,r){let n=this._xssSanitaizeDecode(i);if("link"==t.attr("data-custum-type")){let e=t.parents("td").find("a"),a=e.attr("data-url-tmp");return a=a.replace("%0",n),e.attr("href",a),e.html(i),void t.val(n)}t.val(n)}_setEntToImage1(t,e,i){t.val(i);var a=this.param.midway_dp+i,r="",n="";this._empty(i)?(r="javascript void(0)",n="img/icon/none.gif"):(r=a,n=a.replace("/orig/","/thum/"));var l=t.next(),s=l.find("a");s[0]&&s.attr("href",r);var o=l.find("img");o[0]&&o.attr("src",n),t.attr("data-fp",i)}_setEntToImageFuk(t,e,i){var a=t.attr("id"),r={midway_dp:this.param.midway_dp};this.cbFileUploadComp.setFilePaths(a,i,r),t.attr("data-fp",i)}displayFilter(t,e,i,a){var r={val1:t,xss:a};if(i||(i=this.param.disFilData),!i)return r;if(!i[e])return r;var n=i[e];a=0;switch(n.fil_type){case"select":r.val1=this.disFilSelect(t,e,n.option);break;case"delete_flg":r.val1=this.disFilDeleteFlg(t,e,n.option),r.xss=0;break;case"flg":r.val1=this.disFilFlg(t,e,n.option),r.xss=0;break;case"money":r.val1=this.disFilMoney(t,e,n.option),r.xss=0}return r}setDisplayFilterData(t){this.param.disFilData=t}disFilSelect(t,e,i){if(null==t)return t;var a={};i&&i.list&&(a=i.list);var r="";return null!=a[t]&&(r=a[t]),r}disFilDeleteFlg(t,e,i){return null==t?t:1==t?'<span style="color:#b4b4b4;">削除</span>':'<span style="color:#23d6e4;">有効</span>'}disFilFlg(t,e,i){null!=t&&""!=t&&0!=t||(t=0),t>0&&(t=1);var a=i.list[t];return 1==t?'<span style="color:#23d6e4;">'+a+"</span>":'<span style="color:#b4b4b4;">'+a+"</span>"}disFilMoney(t,e,i){if(null==t)return t;var a="&yen;";return i&&i.currency&&(a=i.currency),a+String(t).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}_getFieldEntByField(t){var e=this.fieldHashTable[t];return this.fieldData[e]}_showForm(t,e,i){if(null==i&&(i={}),null==i.form_position&&(i.form_position=this.param.form_position,"sp"==this.param.device_type&&(i.form_position="max")),"sp"==this.param.device_type){var a=t.find("table");a.addClass("tbl_sp"),a.find("label.text-danger").hide()}if((null==i.use_show_form_strategy&&(i.use_show_form_strategy=1),0==this.param.auto_close_flg&&(this.param.form_z_index++,t.css("z-index",this.param.form_z_index)),t.show(),1==i.use_show_form_strategy&&null!=this.showFormStrategy)&&1==this.showFormStrategy.showForm(t,e))return;e instanceof jQuery||(e=jQuery(e));var r=e.offset(),n=r.left,l=r.top,s=jQuery(window).width(),o=this.param.form_width,h=this.param.form_height;this._empty(o)&&(o=t.outerWidth()),this._empty(h)&&(h=t.outerHeight());var d=l+e.outerHeight(),_=0,c=s;if(!this._empty(this.param.contents_slt)){var p=jQuery(this.param.contents_slt);p[0]&&(_=p.offset.left,c=p.width())}switch(i.form_position){case"left":_=n-o;break;case"center":_=c/2-o/2;break;case"right":_=n;break;case"max":o=c-2;break;default:(_=n)+o>c&&(_=c-o)}_<0&&(_=0),t.offset({top:d,left:_}),this._empty(o)||t.width(o),this._empty(h)||t.height(h),this._fitForm(t)}_addMoreFieldData(t,e){if(!e&&!(e=this._getFieldDataFromTh()))throw new Error("fieldDataを取得できません。th要素のclass属性にフィールド名を指定してください。");var i=[];return jQuery("#"+t+" th").each((t,a)=>{var r=jQuery(a).text(),n=null;if(e[t]&&(n=e[t]),null!=n){var l={index:t,field:n,wamei:r};i.push(l),t++}}),i}_getFieldDataFromTh(){var t=[],e="#"+this.param.tbl_slt+" th";return jQuery(e).each((e,i)=>{var a=jQuery(i),r=this._getFieldByClassOrName(a);r&&t.push(r)}),t}_createFieldHashTable(t){var e={};for(var i in t){e[t[i].field]=i}return e}_initFormInfo(t){var e={},i=this._classifySlt(t.new_form_slt),a=jQuery(i.slt);e.new_inp={xid:i.xid,slt:i.slt,show_flg:0,form:a},0==this.param.form_mode&&this._convertFormToDlg(e.new_inp),i=this._classifySlt(t.edit_form_slt);var r=jQuery(i.slt);e.edit={xid:i.xid,slt:i.slt,show_flg:0,form:r},0==this.param.form_mode&&this._convertFormToDlg(e.edit);i=this._classifySlt(t.delete_form_slt);var n=jQuery(i.slt);e.delete={xid:i.xid,slt:i.slt,show_flg:0,form:n},this._convertFormToDlg(e.delete);i=this._classifySlt(t.eliminate_form_slt);var l=jQuery(i.slt);return e.eliminate={xid:i.xid,slt:i.slt,show_flg:0,form:l},this._convertFormToDlg(e.eliminate),e}_errShow(t,e){var i=this.getForm(e);if(this._clearValidErr(i),"string"==typeof t)(r=i.find(this.param.valid_msg_slt))[0]&&(r.length>1&&(r=r.eq(0)),r.html(t.err_msg)),r.html(t);else if(t[0])for(var a in t){var r,n=t[a];(r=i.find(n.err_slt)).html(n.err_msg)}else(r=i.find(t.err_slt)).html(t.err_msg)}searchKjs(){var t=this._getUrlQuery(),e=this._getFormKjsElm(),i={},a=[];for(var r in e.find(".kjs_inp").each((t,e)=>{var r=jQuery(e),n=r.val(),l=r.attr("id");this._emptyNotZero(n)?a.push(l):(n=encodeURIComponent(n),i[l]=n)}),jQuery.extend(t,i),a){delete t[a[r]]}t.page_no=0;var n,l="";for(var s in t){l+=s+"="+t[s]+"&"}""!=l&&(n="?"+(l=l.substr(0,l.length-1))),window.location.href=n}isDefaultKjs(t,e,i){if(null==e){var a=$("#kjs_json").val();e=JSON.parse(a)}if(null==i){var r=$("#def_kjs_json").val();i=JSON.parse(r)}var n={};for(var l in t){n[o=t[l]]=1}var s=1;for(var o in i)if(!n[o]&&null!==e[o]){var h=e[o];this._emptyNotZero(h)&&(h=null);var d=i[o];if(this._emptyNotZero(d)&&(d=null),h!=d){s=0;break}}return s}_getFieldByNameOrClass(t){var e=t.attr("name");if(e||(e=t.attr("class")),!e)return e;var i=(e=e.trim()).indexOf(" ");return-1!=i&&(e=e.substr(0,e.length-i)),e}_getFieldByClassOrName(t){var e=t.attr("class");if(e||(e=t.attr("name")),!e)return e;var i=(e=e.trim()).indexOf(" ");return-1!=i&&(e=e.substr(0,e.length-i)),e}_classifySlt(t){var e="",i="";if(!t)return{xid:e,slt:i};"#"==t.charAt(0)?(e=t.replace("#",""),i=t):(e=t,i="#"+t);var a={xid:e,slt:i};return a}_xssSanitaizeEncode(t){if("object"==typeof t){for(var e in t)t[e]=this._xssSanitaizeEncode(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_xssSanitaizeDecode(t){if("object"==typeof t){for(var e in t)t[e]=this._xssSanitaizeDecode(t[e]);return t}return"string"==typeof t?t.replace(/&lt;/g,"<").replace(/&gt;/g,">"):t}_nl2br(t){return"string"==typeof t?t.replace(/[\n\r]/g,"<br>"):t}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}_emptyNotZero(t){var e=this._empty(t);return e&&(0!==t&&"0"!==t||(e=!1)),e}_getUrlQuery(){if(""==(t=window.location.search)||null==t)return{};for(var t=t.substring(1,t.length),e=t.split("&"),i={},a=0;a<e.length;a++){var r=e[a].split("=");i[r[0]]=r[1]}return i}setShowFormStrategy(t){this.showFormStrategy=t}_setValueEx(t,e){if(t[0]){var i=t.get(0).tagName;if("INPUT"==i||"SELECT"==i){var a=t.attr("type");if("checkbox"==a)0==e||null==e||""==e?t.prop("checked",!1):t.prop("checked",!0);else if("radio"==a){var r=t.attr("name"),n=t.parent().find("[name='"+r+"'][value='"+e+"']");n[0]&&n.prop("checked",!0)}else"string"==typeof e&&(e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">")),t.val(e)}else"TEXTAREA"==i?(""!=e&&null!=e&&"string"==typeof(e=e.replace(/<br>/g,"\r"))&&(e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">")),t.val(e)):"IMG"==i?t.attr("src",e):"AUDIO"==i?t.attr("src",e):(""!=e&&null!=e&&("string"==typeof(e=e.replace(/<br>/g,"\r"))&&(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;")),e=e.replace(/\r\n|\n\r|\r|\n/g,"<br>")),t.html(e))}}saveRequest(t,e){this.autoSave.saveRequest(t,e)}escapeForAjax(t){if("string"==typeof t)return-1!=t.indexOf("&")?(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),encodeURIComponent(t)):t;if("object"==typeof t){for(var e in t)t[e]=this.escapeForAjax(t[e]);return t}return t}rowExchangeAfter(){var t=this.getDataFromTbl(),e=1*jQuery("#page_no").val()*(1*jQuery("#row_limit").val())+1;for(var i in t){t[i].sort_no=e,e++}this._btnsDisabledSwich(!0);var a={reflect_on_tbl:1,afterCallBack:function(){this._btnsDisabledSwich(!1)}.bind(this)};this.saveRequest(t,a)}_btnsDisabledSwich(t){jQuery(".row_edit_btn").prop("disabled",t),jQuery(".row_copy_btn").prop("disabled",t),jQuery(".row_delete_btn").prop("disabled",t),jQuery(".row_enabled_btn").prop("disabled",t),jQuery(".row_eliminate_btn").prop("disabled",t)}_toggleRegBtn(t,e){var i=this.getForm(t),a=i.find(".reg_btn"),r=i.find(".reg_btn_msg");0==e?(a.prop("disabled",!0),r.html("　登録中・・・")):(a.prop("disabled",!1),r.html(""))}_snakeToCamel(t){return t=(t=t.replace(/_./g,t=>t.charAt(1).toUpperCase())).charAt(0).toUpperCase()+t.slice(1)}getKjElms(){var t={};return jQuery(".kj_wrap").each((e,i)=>{var a=(i=jQuery(i)).attr("data-field");t[a]=i}),t}tableTransform(t){1==t?(this.tbl.addClass("table_transform"),jQuery("#table_transform_tbl_mode").show(),jQuery("#table_transform_div_mode").hide()):(this.tbl.removeClass("table_transform"),jQuery("#table_transform_tbl_mode").hide(),jQuery("#table_transform_div_mode").show())}_fukPrevAfterCallback(t,e,i){if(null!=t){var a=t.slice(-2),r=null;if("_n"==a)r="new_inp";else{if("_e"!=a)return;r="edit"}i.self._fitFormByFormType(r)}}_fitFormByFormType(t){var e=this.getForm(t);this._fitForm(e)}_fitForm(t){1==this.param.form_mode?t.css({width:"auto",height:"auto"}):t.css({width:"auto",height:"auto",display:"inline-block"})}_formDragAndResizeSetting(){0==this.param.form_mode&&(this._formDragAndResizeSetting2("new_inp"),this._formDragAndResizeSetting2("edit")),this._formDragAndResizeSetting2("delete"),this._formDragAndResizeSetting2("eliminate")}_formDragAndResizeSetting2(t){if(1==this.param.drag_and_resize_flg){var e=this.getForm(t);if(null!=e&&null!=e.draggable){var i=e.draggable();$(".panel-body",i).mousedown(t=>{i.draggable("disable")}).mouseup(t=>{i.draggable("enable")}),e.resizable()}}}_errByErrTypes(){this.param.errTypes.indexOf("kjs_err")>=0&&jQuery(".cb_kj_detail").show()}openNoteDetail(t,e){t instanceof jQuery||(t=jQuery(t)),null==e&&(e="note");var i=t.parents("td"),a=(i.find("[name='"+e+"']"),i.find("."+e)),r=1,n=i.find(".note_detail");if(!n[0]){r=0;i.append("<div class='note_detail'></div>"),n=i.find(".note_detail")}if("none"==a.css("display"))return a.show(),n.hide(),void t.val("...");if(r)return a.hide(),n.show(),void t.val("閉じる");var l=i.find("[name='"+e+"']").val();null!=l&&""!=l&&(l=(l=this._xssSanitaizeEncode(l)).replace(/\r\n|\n\r|\r|\n/g,"<br>"),n.html(l),a.hide(),t.val("閉じる"))}_setColspanToForm(t){var e=this._getClmCntByActive();return t.find("td").attr("colspan",e),t}_getClmCntByActive(){var t=this.csh.getCshAry(),e=1;for(var i in t)t[i]&&e++;return e}_setColspanToTd(t){var e=this.csh.getCshAry(),i=1;for(var a in e)e[a]&&i++;return form.find("td").attr("colspan",i),form}_iniRtnSetUrl(){var t=this._getHiddensElm(),e=t.find("#referer_url").val(),i=t.find("#now_url").val(),a=this._stringLeft(e,"?",1),r=this._stringLeft(i,"?",1),n=location.href.split(/[?#]/)[0]+"-ini_rtn_url",l="";a==r?null==(l=localStorage.getItem(n))&&(l=i):(l=i,localStorage.setItem(n,l)),jQuery(".ini_rtn").attr("href",l)}_getHiddensElm(){return null==this.hiddensElm&&(this.hiddensElm=jQuery("#hiddens_data")),this.hiddensElm}_stringLeft(t,e,i){if(null==t||""==t)return t;var a=t.indexOf(e);return-1==a&&1==i?t:t.substring(0,a)}_addEventForKjsEnter(){this._getFormKjsElm().find("input").keypress(t=>{13==t.which&&this.searchKjs()})}_getFormKjsElm(){return null==this.formKjsElm&&(this.formKjsElm=jQuery(".form_kjs")),this.formKjsElm}calendarViewCreate(t){var e=this.getDataFromTbl();this.calendarViewK.create(e,t)}reactInit(t){(new Date).getTime();var e=this._getFields();this.crudBaseReact.init(e,t)}reactivatingOfRow(){this.crudBaseReact.reactivatingOfRow()}_getFields(){if(null!=this.fields)return this.fields;var t=[];for(var e in this.fieldData){var i=this.fieldData[e];t.push(i.field)}return this.fields=t,this.fields}initCbGtaCash(t,e){null!=this.cbGtaCash&&this.cbGtaCash.init(t,e)}_getKjs(){if(null==this.kjs){var t=jQuery("#kjs_json").val();this.kjs=JSON.parse(t)}return this.kjs}sessionClear(){this.csh.reset(),this.crudBaseConfig.reset(),this.cbBtnSizeChanger.clearReset(),location.href="?ini=1&sc=1"}}class CrudBaseAutoSave{constructor(t){this.crudBase=t,this.fieldData=t.fieldData,this.tbl=t.tbl,this.msgElm=jQuery("#crud_base_auto_save_msg"),this.data,this.set_timeout_hdl}saveRequest(t,e){this.data=t,null==e&&(e={}),null==e.reflect_on_tbl&&(e.reflect_on_tbl=0),null==e.interval&&(e.interval=3e3),null==e.afterCallBack&&(e.afterCallBack=null),this.option=e,null!=this.set_timeout_hdl&&clearTimeout(this.set_timeout_hdl),this.set_timeout_hdl=setTimeout(()=>{this._autoSave(this.data),1==e.reflect_on_tbl&&this.crudBase.setDataToTbl(null,t)},e.interval)}_autoSave(t){if(this.msgElm.html("保存中..."),console.log("自動保存"),null==t)t=this.crudBase.getDataHTbl();t=this.crudBase.escapeForAjax(t);var e=JSON.stringify(t),i=this.crudBase.param.auto_save_url;jQuery.ajax({type:"POST",url:i,data:"key1="+e,cache:!1,dataType:"text"}).done((t,e)=>{try{jQuery.parseJSON(t),this.msgElm.html("")}catch(e){return this.msgElm.html("自動保存のエラー1"),void jQuery("#err").html(t)}this.option.afterCallBack&&this.option.afterCallBack()}).fail((t,e,i)=>{this.msgElm.html("自動保存のエラー2"),jQuery("#err").html(t.responseText)})}}class CrudBaseBulkAdd{constructor(t){this.fieldData=t}init(t,e){for(var i in t){var a=t[i];a.wamei=this._getWameiFromFieldData(a.field)}this.inpFields=t,this.param=this._initParam(e)}_getWameiFromFieldData(t){var e=t;for(var i in this.fieldData){var a=this.fieldData[i];if(t==a.field){e=a.wamei;break}}return e}_initParam(t){if(null==t&&(t={}),null==t.ajax_url)throw new Error("Not empty ajax_url in param!");return null==t.ta_placeholder&&(t.ta_placeholder="Excelからコピーした行列を貼り付けてください。\n(例)\nネコ名A\t100\nネコ名B\t101\n"),null==t.ta_height&&(t.ta_height="20rem"),null==t.test_mode&&(t.test_mode=0),t}showForm(){if(this.form)return this.form.show(),this.form.find("#cbba_inps_div").show(),void this.form.find("#cbba_preview_div").hide();var t=this.param,e=this._makeSameApplysHtml(),i="";this.param.test_mode&&(i=this._getTestText());var a=`\n\t\t\t<div id="cbba_div" >\n\t\t\t\t<div id="cbba_head" >\n\t\t\t\t\t<h4>一括追加</h4>\n\t\t\t\t\t<div id="cbba_close_btn_w" style="">\n\t\t\t\t\t\t<input id="cbba_close_btn" type='button' value="閉じる" class="btn btn-primary btn-xs" onclick="" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div style="clear:both"></div>\n\t\t\t\t\n\t\t\t\t<div id="cbba_inps_div">\n\t\t\t\t\t<textarea id="cbba_ta" placeholder="${t.ta_placeholder}" style='height:${t.ta_height}'>${i}</textarea>\n\t\t\t\t\t<div id="cbba_same_applys_w">${e}</div>\n\t\t\t\t\t<div id="cbba_preview_btn_w">\n\t\t\t\t\t\t<input id="cbba_preview_btn" type="button" value="プレビュー" class="btn btn-success" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div id="cbba_preview_div" style="display:none">\n\t\t\t\t\t<div id="cbba_preview_div2">\n\t\t\t\t\t</div>\n\t\t\t\t\t<input id="cbba_reg_btn" type="button" value="一括追加" class="btn btn-danger" />\n\t\t\t\t\t<input id="cbba_rtn_btn" type="button" value="戻る" class="btn btn-primary" />\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div id="cbba_err" class="text-danger"></div>\n\t\t\t</div>\n\t\t`,r=jQuery("#crud_base_bulk_add");r.html(a),r.find("#cbba_close_btn").click(t=>{this.form.hide()}),r.find("#cbba_reg_btn").click(t=>{this._bulkAdd()}),r.find("#cbba_rtn_btn").click(t=>{this._returnToInput()}),r.find("#cbba_preview_btn").click(t=>{this._preview()}),this.form=r,this.form.show()}_returnToInput(){this.form.find("#cbba_preview_div").hide(),this.form.find("#cbba_inps_div").show()}_getTestText(){return"ロイヤルアナロスタン\t101\nロード・ゴート\t102\nツィッツァ\t103\nイッパイアッテナ\t104\n<input />\t105\nおキャット様.'\"\t106"}_makeSameApplysHtml(){var t="",e=this.inpFields;for(var i in e){var a=e[i];switch(a.inp_type){case"text":t+=this._makeSameApplyTypeText(a);break;case"date":t+=this._makeSameApplyTypeDate(a);break;case"select":t+=this._makeSameApplyTypeSelect(a);break;case"sort_no":t+=this._makeSameApplyTypeSortNo(a)}}return t}_makeSameApplyTypeText(t){var e="";return null!=t.def&&(e=t.def),`\n\t\t\t<div class="same_apply_w">\n\t\t\t\t<label>${t.wamei}</label>\n\t\t\t\t<input type="text" class="same_apply ${t.field}" value="${e}" />\n\t\t\t</div>\n\t\t`}_makeSameApplyTypeDate(t){var e="";return null!=t.def&&(e=t.def,e=this._convDateTo_yyyymmdd(e)),`\n\t\t\t<div class="same_apply_w">\n\t\t\t\t<label>${t.wamei}</label>\n\t\t\t\t<input type="date" class="same_apply ${t.field}" value="${e}" />\n\t\t\t</div>\n\t\t`}_makeSameApplyTypeSelect(t){var e=null;null!=t.def&&(e=t.def);var i="";for(var a in t.list){var r="";e==a&&(r="selected"),i+=`<option value='${a}' ${r}>${t.list[a]}</option>`}return`\n\t\t\t<div class="same_apply_w">\n\t\t\t\t<label>${t.wamei}</label>\n\t\t\t\t<select class="same_apply ${t.field}">${i}</select>\n\t\t\t</div>\n\t\t`}_makeSameApplyTypeSortNo(t){var e="",i="";return 1==t.def?i="checked":e="checked",`\n\t\t\t<div class="same_apply_w">\n\t\t\t\t<label>追加場所</label>\n\t\t\t\t<label class='cbba_sort_no_label'>\n\t\t\t\t\t<input type="radio" name="cbba_sort_no" value="0" ${e}>\n\t\t\t\t\t先頭に追加\n\t\t\t\t</label>\n\t\t\t\t<label class='cbba_sort_no_label'>\n\t\t\t\t\t<input type="radio" name="cbba_sort_no" value="1" ${i}>\n\t\t\t\t\t末尾に追加\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t`}_convDateTo_yyyymmdd(t){if("string"==typeof t&&"Invalid Date"==(t=new Date(t)))return null;var e=t.getFullYear(),i=t.getMonth()+1;i=("0"+i).slice(-2);var a=t.getDate();return e+"-"+i+"-"+(a=("0"+a).slice(-2))}_preview(){var t=[];if(t=this._getDataFromTextArea(t),this._err(""),0!=t.length){t=this._getDataFromSameApplys(t);var e=jQuery.extend(!0,{},t);e=this._xss_sanitize(e);var i=this._makePrviewHtml(e),a=this.form.find("#cbba_preview_div");a.find("#cbba_preview_div2").html(i),a.show(),this.form.find("#cbba_inps_div").hide(),this.data=t}else this._err("テキストエリアが空です。")}_getDataFromTextArea(t){var e=this.form.find("#cbba_ta").val(),i=this._makeADataFromTaText(e),a=this._filteringToTaInpFields();for(var r in i){var n=i[r],l={};for(var s in a){var o=a[s].field;null==n[s]?l[o]="":l[o]=n[s]}t.push(l)}return t}_makeADataFromTaText(t){var e=[],i=t.split("\n");for(var a in i){var r=i[a];if(""!=r){var n=r.split("\t");e.push(n)}}return e}_filteringToTaInpFields(){var t=this.inpFields,e=[];for(var i in t){var a=t[i];"textarea"==a.inp_type&&e.push(a)}return e}_getDataFromSameApplys(t){var e=this._filteringInpFieldsByInpTypes(["text","date","select"]);for(var i in e){var a=e[i].field,r="",n=this.form.find("."+a);for(var l in n[0]&&(r=n.val()),t){t[l][a]=r}}return t}_filteringInpFieldsByInpTypes(t){var e=this.inpFields,i=[];for(var a in e){var r=e[a];t.indexOf(r.inp_type)>=0&&i.push(r)}return i}_makePrviewHtml(t){if(0==t.length)return"";var e=this._getTHeads(t[0]),i="<table class='tbl2'>";i+="<thead><tr>";var a=t[0];for(var r in a){i+="<th>"+e[r]+"</th>"}for(var n in i+="</tr></thead>",t){var l=t[n];for(var s in i+="<tr>",l)i+="<td>"+l[s]+"</td>";i+="</tr>"}return i+="</table>"}_getTHeads(t){var e={},i=this.fieldData;for(var a in t){var r=a;for(var n in i){var l=i[n];if(a==l.field){r=l.wamei;break}}e[a]=r}return e}_xss_sanitize(t){if("object"==typeof t){for(var e in t)t[e]=this._xss_sanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_bulkAdd(){this._anabledBulkAddBtn(!1);var t=this._getAddPosition();this.param.add_position=t;var e={add_position:t};this._ajax("cbba_get_sort_no",e,this._bulkAdd2)}_bulkAdd2(t,e){var i=e.next_sort_no,a=t.param.add_position,r=t.data,n=i;for(var l in r){r[l].sort_no=n,1==a?n++:n--}var s={data:r};t._ajax("cbba_add_reg",s,t._bulkAdd3)}_bulkAdd3(t,e){var i=e.newIds,a=t.data;for(var r in a){var n=a[r],l=i[r];n.id=l}var s=e.err_msg;""==s?location.reload(!0):t._err(s)}_ajax(t,e,i){var a=this.param.ajax_url;e.action_code=t;var r=JSON.stringify(e);jQuery.ajax({type:"POST",url:a,data:"key1="+r,cache:!1,dataType:"text"}).done((t,e)=>{var a=null;try{a=jQuery.parseJSON(t)}catch(e){return void this._err(t)}i(this,a)}).fail((t,e,i)=>{this._err(t.responseText)})}_anabledBulkAddBtn(t){null==t&&(t=!1),null==this.regBtn&&(this.regbtn=this.form.find("#cbba_reg_btn"));var e=this.regbtn;1==t?(e.val("一括追加"),e.prop("disabled",!1)):(e.val("追加中・・・"),e.prop("disabled",!0))}_getAddPosition(){var t=this.form.find('input[name="cbba_sort_no"]:checked'),e=1;return t[0]&&(e=t.val()),e}_err(t){null==this.errElm&&(this.errElm=this.form.find("#cbba_err")),this.errElm.html(t)}}class CrudBaseConfig{init(t,e){this.param=this._setParamIfEmpty(t),this.tDiv=jQuery("#"+this.param.div_xid),this.data=this._getData(e);let i=this._createHtml();this.tDiv.html(i),this.fShowBtn=this.tDiv.find(".cb_conf_f_show_btn"),this.funcDiv=this.tDiv.find(".cb_conf_func_div"),this.resDiv=this.tDiv.find(".cb_conf_res"),this.errDiv=this.tDiv.find(".cb_conf_err"),this.applyBtn=this.tDiv.find(".cb_conf_apply_btn"),this.defBtn=this.tDiv.find(".cb_conf_def_btn"),this.form=this.tDiv.find(".cb_conf_form"),this._addClickFShowBtn(this.fShowBtn),this._addClickApplyBtn(this.applyBtn),this._addClickDefBtn(this.defBtn),this.cbBtnSizeChanger=new CbBtnSizeChanger,this.setDataToUi(this.data)}_getData(t){null==t&&(t=[]);let e=$.extend(!0,{},t);null==e.delete_alert_flg&&(e.delete_alert_flg=0);let i=$.extend(!0,{},e),a=this._getDataFromLs();return i=$.extend(i,a),this.defData=e,this.lsData=a,this.data=i,i}_setFlg(t,e,i){let a=i;return null!=t[e]&&(a=t[e]),a}_setParamIfEmpty(t){return null==t&&(t={}),null==t.div_xid&&(t.div_xid="crud_base_config"),t}_createHtml(){return'\n\t<input class=\'cb_conf_f_show_btn btn btn-default btn-xs\' type="button" value=\'設定\' />\n\t<div class=\'cb_conf_func_div\' style="display:none">\n\t\t<div style="display:inline-block;padding:10px;border:solid 4px #5bd59e;border-radius:5px;margin-bottom:10px">\n\t\t\t<div style="color:#5bd59e;font-weight:bold">設定</div>\n\t\t\t\n\t\t\t<input value="ボタン設定" type="button" class="btn btn-default btn-xs" onclick="jQuery(\'#CbBtnSizeChanger\').toggle(300);" />\n\t\t\t<div id="CbBtnSizeChanger" style="display:none"></div>\n\t\t\t\n\t\t\t<table class=\'cb_conf_form tbl2\' style="margin-top:8px"><tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td><input class="cbcf_delete_alert_flg" type="checkbox" value=\'1\'></td>\n\t\t\t\t\t<td>削除アラート: 一覧行の削除ボタンを押したときにアラートを表示する。</td>\n\t\t\t\t<tr>\n\t\t\t</tbody></table>\n\t\t\t\n\t\t\t<div style="margin-top:8px">\n\t\t\t\t<input class="cb_conf_apply_btn btn btn-success" type=\'button\' value="適用" />\n\t\t\t\t<input class="cb_conf_def_btn btn btn-default btn-xs" type=\'button\' value="初期に戻す" />\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="cb_conf_res text-success"></div>\n\t\t\t<div class="cb_conf_err text-danger"></div>\n\t\t</div>\n\t</div>\n\t\t'}_getDataFromLs(){let t=this._getLsKey(),e=localStorage.getItem(t),i=JSON.parse(e);return null==i&&(i={}),i}clearlocalStorage(){let t=this._getLsKey();localStorage.removeItem(t)}_saveData(t,e){this.data[t]=e;let i=this._getLsKey();var a=JSON.stringify(this.data);localStorage.setItem(i,a)}_getLsKey(){let t=location.href;return t=t.split(/[?#]/)[0],t+="_CrudBaseConfig"}_showErr(t){this.errDiv.append(t+"<br>")}_addClickFShowBtn(t){t.click(t=>{var e=this.funcDiv.css("display");if(null==e|"none"==e){let t=this._getFShowBtnName(0);this.fShowBtn.val(t),this.tDiv.css("display","block"),this.funcDiv.show(300)}else{let t=this._getFShowBtnName(1);this.fShowBtn.val(t),this.tDiv.css("display","inline-block"),this.funcDiv.hide(300)}})}_addClickApplyBtn(t){t.click(t=>{this.clickApplyBtn()})}clickApplyBtn(){this.data.delete_alert_flg=this._getFromCheckbox("delete_alert_flg");let t=this._getLsKey();var e=JSON.stringify(this.data);localStorage.setItem(t,e)}_getFromCheckbox(t){let e=this.form.find(".cbcf_"+t+":checked").val();return null==e&&(e=0),e}_getFShowBtnName(t){let e=this.fShowBtn.val();return 1==t?e=e.replace(" (閉じる)",""):e+=" (閉じる)",e}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}_addClickDefBtn(t){t.click(t=>{this.reset()})}reset(){this.data=$.extend(!0,{},this.defData),this.setDataToUi(this.data);let t=this._getLsKey();localStorage.removeItem(t)}setDataToUi(t){this._setCheckbox(t,"delete_alert_flg")}_setCheckbox(t,e){let i=this.form.find(".cbcf_"+e);this._empty(t[e])?i.prop("checked",!1):i.prop("checked",!0)}}class CrudBasePasswordEdit{constructor(t,e,i){this.newInpForm=t,this.editForm=e,this.param=this._setParamIfEmpty(i);var a=[];a=this._getPwElmsFromNewInp(a,t,"new_inp"),a=this._getPwElmsFromNewInp(a,e,"edit"),a=this._createPwChgbtns(a),this._setClickEventToBtn(a),this.data=a}_setParamIfEmpty(t){return null==t&&(t={}),t}_getPwElmsFromNewInp(t,e,i){var a=e.find("input[name='password']");return a[0]?(a.each((e,a)=>{var r={pwElm:jQuery(a),pw_index:e,form_type:i};t.push(r)}),t):t}_createPwChgbtns(t){for(var e in t){var i=t[e],a=i.form_type,r=i.pw_index,n=`<input type="button" id="${"cbpe_"+a+r}" value="パスワード変更" data-form-type="${a}" data-pw-index="${r}" class="btn btn-warning btn-xs" />`;i.pwElm.after(n);var l=this._getBtnElm(a,r);i.btnElm=l}return t}_getBtnElm(t,e){var i=null;"new_inp"==t&&(i=this.newInpForm),"copy"==t&&(i=this.newInpForm),"edit"==t&&(i=this.editForm);var a="cbpe_"+t+e;return i.find("#"+a)}_setClickEventToBtn(t){for(var e in t){t[e].btnElm.click(t=>{this.clickPwChgbtn(this,t.currentTarget)})}}clickPwChgbtn(t,e){var i=(e=jQuery(e)).attr("data-form-type"),a=e.attr("data-pw-index"),r=this._getEntity(i,a);if(null!=r){var n=r.pwElm;n.val(""),n.show(),(e=r.btnElm).hide()}}_getEntity(t,e){for(var i in this.data){var a=this.data[i];if(a.form_type==t&&a.pw_index==e)return a}return null}showForm(t){0!=this.data.length&&("new_inp"==t?this._changeForNewInp(t):this._changeForEditAndCopy(t))}_changeForNewInp(t){for(var e in this.data){var i=this.data[e];if(i.form_type==t)i.btnElm.hide(),i.pwElm.show()}}_changeForEditAndCopy(t){for(var e in this.data){var i=this.data[e];i.btnElm.show(),i.pwElm.hide()}}}class CrudBaseReact{constructor(t){}_setParamIfEmpty(t){return null==t&&(t={}),t}init(t,e){this.fields=t;var i=e.split(",");for(var a in i){var r=i[a];i[a]=r.trim()}this.hyoIds=i}reactivatingOfRow(){}}class CrudBaseRowExchange{constructor(t,e,i){null==e&&(e={});var a=t.param.tbl_slt;this.afterCallback=i,this.tbl=t.tbl;var r="#exchange_tr_form_"+a;e.form_slt=r;var n=this._getFormHtml(r);this.tbl.after(n),this.form=jQuery(r),this.param=e,this.form.find(".exchange_tr_form_close").click(()=>{this.form.hide()}),this.form.find(".exchange_tr_btn").click(()=>{this._exchageTrReb()}),jQuery(r+" input").keypress(t=>{13==t.which&&this._exchageTrReb()}),this.form.find(".exchange_tr_shift_up").click(()=>{this._exchageTrShiftUp()}),this.form.find(".exchange_tr_shift_down").click(()=>{this._exchageTrShiftDown()})}showForm(t){var e=jQuery(t),i=e.parents("tr").index();i+=1,this.param.from_row_index=i;var a=this.form.find(".exchange_tr_sort_no"),r=a.val();this._empty(r)&&a.val(i),this._showForm(this.form,e)}_exchageTrReb(){var t=this.param.from_row_index,e=this.form.find(".exchange_tr_sort_no").val();0!=this._checkRowIndex(e)&&t!=e&&this._exchageTr(t,e)}_exchageTrShiftUp(){var t=this.param.from_row_index,e=t-1;e<=0||(this._exchageTr(t,e),this.param.from_row_index=e)}_exchageTrShiftDown(){var t=this.param.from_row_index,e=t+1;e>this.tbl.children("tbody").children("tr").length||(this._exchageTr(t,e),this.param.from_row_index=e)}_exchageTr(t,e){var i=this.tbl.find("tr").eq(t),a=this.tbl.find("tr").eq(e);t>e?jQuery(a).before(i):jQuery(a).after(i),this.afterCallback&&this.afterCallback({from_row_index:t,to_row_index:e})}_checkRowIndex(t){return null!=t&&(!!t.match(/^[0-9]*$/)&&!(t<=0))}_showForm(t,e,i){i||(i="auto"),t.show();var a=(e=jQuery(e)).offset(),r=a.left,n=a.top,l=jQuery(window).width(),s=t.outerWidth(),o=n+e.outerHeight(),h=0;switch(i){case"left":h=r-s;break;case"center":h=l/2-s/2;break;case"right":h=r;break;default:(h=r)+s>l&&(h=l-s)}h<0&&(h=0),t.offset({top:o,left:h})}_getFormHtml(t){var e=this._sltToCode(t);return"<div id='"+e+"_rap'>\t<div id='"+e+"' class='panel panel-primary' style='display:none;width:170px;'>\t\t<div class='panel-heading'>\t\t\t\t\t\t<div style='display:inline-block;width:80%'>行入替</div>\t\t\t<div style='display:inline-block;width:15%'>\t\t\t\t<button type='button' class='exchange_tr_form_close btn btn-primary btn-sm'>\t\t\t\t\t<span class='glyphicon glyphicon-remove'></span>\t\t\t\t</button>\t\t\t</div>\t\t</div>\t\t<div class='panel-body' \">\t\t\t<button type='button' class='exchange_tr_shift_up btn btn-primary btn-sm'><span class='glyphicon glyphicon-arrow-up'></span></button>\t\t\t<button type='button' class='exchange_tr_shift_down btn btn-primary btn-sm'><span class='glyphicon glyphicon-arrow-down'></span></button>\t\t\t<div style='margin-top:20px'>\t\t\t\t<input class='exchange_tr_sort_no' type='number' style='width:60px' min='1' max='9999'  />\t\t\t\t<input type='button' value='行入替' class='exchange_tr_btn btn btn-warning btn-sm' />\t\t\t</div>\t\t</div>\t</div></div>"}_sltToCode(t){var e=t,i=e.charAt(0);return"#"!=i&&"."!=i||(e=e.substr(1)),e}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}class CsvExin{init(t,e){this.mainElm=jQuery("#csv_exin"),this.csvFieldData=t,this.csvParam=this._setParamIfEmpty(e),this.data;this.mainElm.html('\n\t\t\t<div id="csv_exin_step1">\n\t\t\t\t<label><input type="radio" name="csv_exin_str_code" value=\'utf-8\' checked />UTF-8</label>\n\t\t\t\t<label style="font-weight:normal;color:#808080" title="iosの波ダッシュ「〜」はWindowsのShift-jisにおいて文字化けします。">\n\t\t\t\t\t<input type="radio" name="csv_exin_str_code" value=\'Shift_JIS\' />Shift-Jis(非推奨)</label>\n\t\t\t\t<input id="csv_exin_file" type="file" multiple >\n\t\t\t</div>\n\t\t\t<aside>基本的に上書きでDB登録されますが、idが空のレコードもしくはDBに存在しないidのレコードは「新規追加」になります。</aside>\n\t\t\t<div id="csv_exin_step2" style="display:none">\n\t\t\t\t<input id="csv_bulk_reg_btn" type="button" value="一括登録" class="btn btn-danger btn-sm" />\n\t\t\t\t<input id="csv_exin_retry_btn" type="button" value="やり直し" class="btn btn-default btn-xs" />\n\t\t\t</div>\n\t\t\t<div id="csv_exin_err" style="color:red"></div>\n\t\t\t<div id="csv_exin_success" class="text-success"></div>\n\t\t\t<div id="csv_exin_preview" style="overflow:auto;height:400px;display:none"></div>\n\t\t'),this.bulkRegBtn=this.mainElm.find("#csv_bulk_reg_btn"),this._addEventStrCodeRadioClick(),this._addEventRetryBtn(),this._addEventFileChange(),this._addEventBulkReg()}_setParamIfEmpty(t){return null==t&&(t={}),null==t.ajax_url&&(t.ajax_url="dummy"),t}_addEventFileChange(){this.mainElm.find("#csv_exin_file").change(t=>{var e=t.target.files[0],i=new FileReader;i.readAsText(e,this.csvParam.str_code),i.onload=t=>{var e=t.target.result;this._preview(e)}})}_addEventBulkReg(){this.mainElm.find("#csv_bulk_reg_btn").click(t=>{this._bulkReg()})}_preview(t){var e=this.csvFieldData,i=this.csvParam;this._errShow(""),this.mainElm.find("#csv_exin_step1").hide(),this.mainElm.find("#csv_exin_step2").show();var a=this._csvTextToData(t),r=this._checkD2ary(a);if(r)this._errShow(r);else{var n=this._getClmHederFlgEtc(a,e);i.clm_header_flg=n.clm_header_flg,i.id_clm_flg=n.id_clm_flg;var l=a[0],s=this._makeIndexHashmap(l,e);if(r=this._checkClmName(l,e,s))this._errShow(r);else{var o=this._createDataFromD2ary(a,e,s);this.data=o;var h=$.extend(!0,{},o);h=this._xss_sanitize(h);var d=this._makeTableHtml(h,e,s),_=this.mainElm.find("#csv_exin_preview");_.show(),_.html(d),this.bulkRegBtn.show()}}}_getClmHederFlgEtc(t,e){var i={clm_header_flg:0,id_clm_flg:0},a=t[0][0];return 0==isNaN(a)?(i.id_clm_flg=1,i):"id"==a.toLowerCase()?(i.clm_header_flg=1,i.id_clm_flg=1,i):a==e[1].clm_name?(i.clm_header_flg=1,i):i}_createDataFromD2ary(t,e,i){var a=[];for(var r in t)if(0!=r){var n=t[r],l={};for(var s in i){var o=e[i[s]].field,h=n[s];l[o]=h}a.push(l)}return a}_makeIndexHashmap(t,e){var i={};for(var a in t){var r=t[a];for(var n in r=r.trim(),e){var l=e[n];if(l.clm_name==r)i[a]=n;else{if(null==l.clm_alias_names)continue;for(var s in l.clm_alias_names){var o=l.clm_alias_names[s];null!=o&&""!=o&&(o!=r||(i[a]=n))}}}}return i}_checkClmName(t,e,i){var a=null;for(var r in t){var n=t[r],l=0;for(var s in t){n==t[s]&&l++}if(l>=2)return a="列名「"+n+"」が重複しています。同じ列名は使えません"}var o={};for(var h in i){o[_=i[h]]=h}var d=[];for(var _ in e)if(null==o[_]){var c=e[_];1==c.req_flg&&d.push(c.clm_name)}d.length>0&&(a="次の列名は必須です。→"+d.join(","));return a}_addEventStrCodeRadioClick(){this.mainElm.find("input[name='csv_exin_str_code']").click(t=>{var e=$(t.currentTarget);this.csvParam.str_code=e.val(),this.mainElm.find("#csv_exin_file").prop("disabled",!1)})}_addEventRetryBtn(){this.mainElm.find("#csv_exin_retry_btn").click(t=>{this.mainElm.find("#csv_exin_file").val(""),this.mainElm.find("#csv_exin_step1").show(),this.mainElm.find("#csv_exin_step2").hide(),this.mainElm.find("#csv_exin_err").html("");var e=this.mainElm.find("#csv_exin_preview");e.hide(),e.html("")})}_csvTextToData(t){if(""==t||null==t)return null;t[t.length-1].match(/\r|\n/)||(t+="\n");for(var e=[],i=t.length,a=0,r="",n=[],l=0;l<i;l++){var s=t[l];if(0==a)if('"'==s)a=1;else if(","==s)n.push(r),r="";else if(s.match(/\r|\n/)){if(n.push(r),e.push(n),r="",n=[],l<i-1)t[l+1].match(/\r|\n/)&&l++}else r+=s;else if('"'==s){if(l<i-1)'""'==s+t[l+1]?(r+='"',l++):a=0}else r+=s}return e}_checkD2ary(t){return null==t?"CSVのデータが空です。":0==t.length?"CSVのデータが空です。":0==t[0].length?"対象のCSVファイルではありません。":1==t[0].length?"対象のCSVファイルではありません。":null}_makeTableHtml(t,e,i){var a="<table id='csv_exin_table' class='tbl2' style='white-space:nowrap;'>";for(var r in a+="<thead><tr>",i){a+="<th>"+e[i[r]].clm_name+"</th>"}for(var n in a+="</tr></thead><tbody>",t){var l=t[n];for(var s in a+="<tr>",l){var o=l[s];"string"==typeof o&&(o=o.replace(/\r\n|\r|\n/g,"<br>")),null==o&&(o=""),a+="<td>"+o+"</td>"}a+="</tr>"}return a+="</tbody></table>"}_xss_sanitize(t){if("object"==typeof t){for(var e in t)t[e]=this._xss_sanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_errShow(t){this.mainElm.find("#csv_exin_err").html(t),this.bulkRegBtn.hide()}_bulkReg(){var t=this.csvParam,e=this.data,i={data:e=this._ampTo26(e),csvFieldData:this.csvFieldData,csvParam:this.csvParam},a=JSON.stringify(i);this.mainElm.find("#csv_exin_success").html("登録中です..."),jQuery.ajax({type:"POST",url:t.ajax_url,data:"key1="+a,cache:!1,dataType:"text"}).done((t,e)=>{var i;try{i=jQuery.parseJSON(t),console.log(i),location.reload(!0)}catch(e){return void this._errShow(t)}console.log(i)}).fail((t,e,i)=>{this._errShow(t.responseText),alert(e)})}_ampTo26(t){if("string"==typeof t)return-1!=t.indexOf("&")?t.replace(/&/g,"%26"):t;if("object"==typeof t){for(var e in t)t[e]=this._ampTo26(t[e]);return t}return t}}
/**
 * CSVフィールドデータ補助クラス
 * 
 * @version 0.9.1
 * @date 2019-6-28 | 2019-8-13
 * @auther kenji uehara
 * @license MIT
 */class CsvFieldDataSupport{normalizeCsvFieldData(t,e){for(let i in t){let a=t[i];if(null==a.field)throw new Error("CsvFieldData: 'field' is empty!");if(null==a.clm_name&&null==a.wamei)throw Error("CsvFieldData: clm_name and wamei is empty!");if(null==a.clm_name&&null!=a.wamei&&(a.clm_name=a.wamei),null!=a.clm_name&&null==a.wamei&&(a.wamei=a.clm_name),null==a.clm_alias_names&&(a.clm_alias_names=null),null==a.req_flg&&(a.req_flg=!1),null==a.req_clm&&(a.req_clm=a.req_flg),null==a.join_type&&(a.join_type=null),null==a.id_field&&(null!=a.join_type?a.id_field=a.field.replace("_name","_id"):a.id_field=null),null==a.model_name&&null==a.master&&null==a.tbl_name){let t=this._tblNameToModelName(e);a.model_name=t,a.master=t,a.tbl_name=e}else{let t=this._getTblNames(a),e=t.model_name,i=t.tbl_name;null==a.model_name&&(a.model_name=e),null==a.master&&(a.master=e),null==a.tbl_name&&(a.tbl_name=i)}if("const"==a.join_type){if(null==a.idMap)throw new Error(`CsvFieldData: ${a.field}: ipMap is empty!`)}else a.idMap=null;null==a.import_flg&&(a.import_flg=!0),null==a.export_flg&&(a.export_flg=!0),null==a.inp_type&&(null==a.id_field?a.inp_type="text":a.inp_type="select")}return t}_tblNameToModelName(t){return""==t||null==t?"":("s"==(t=(t=t.replace(/_./g,(function(t){return t.charAt(1).toUpperCase()}))).charAt(0).toUpperCase()+t.slice(1)).slice(-1)&&(t=t.substr(0,t.length-1)),t)}_modelNameToTblName(t){return""==t||null==t?"":(t=(t=t.charAt(0).toLowerCase()+t.slice(1)).replace(/([A-Z])/g,(function(t){return"_"+t.charAt(0).toLowerCase()})),t+="s")}_getTblNames(t){let e=t.tbl_name,i=t.model_name;return null==i&&(i=t.master),null==e&&(e=this._modelNameToTblName(i)),null==i&&(i=this._tblNameToModelName(e)),{tbl_name:e,model_name:i}}}class DatepickerWrap{constructor(t){null!=jQuery.datepicker&&(this.param=this._setParamIfEmpty(t),1==t.ja_flg&&this.datepicker_ja(),this._datepickerApply(),this._datetimepickerApply(),this._ympickerApply())}_setParamIfEmpty(t){return null==t&&(t={}),null==t.ja_flg&&(t.ja_flg=1),null==t.datetimepicker_f&&(t.datetimepicker_f=0),t}_datepickerApply(){jQuery(".datepicker").each((t,e)=>{jQuery(e).datepicker({dateFormat:"yy-mm-dd"})})}_datetimepickerApply(){0!=this.param.datetimepicker_f&&jQuery(".datetimepicker").each((t,e)=>{jQuery(e).datetimepicker({dateFormat:"Y-m-d H:i"})})}_ympickerApply(){var t={closeText:"閉じる",prevText:"&#x3c;前",nextText:"次&#x3e;",currentText:"今日",monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dateFormat:"yy/mm",yearSuffix:"年",onSelect:function(t,e){}};jQuery(".ympicker").each((e,i)=>{jQuery(i).ympicker(t)})}tukishomatu(t,e,i){var a={closeText:"閉じる",prevText:"&#x3c;前",nextText:"次&#x3e;",currentText:"今日",monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dateFormat:"yy/mm",yearSuffix:"年",onSelect:function(t,a){var r=t+"/1";$("#"+e).val(r);var n=new Date(r),l=DateFormat(l=new Date(n.getFullYear(),n.getMonth()+1,0),"yyyy/mm/dd");$("#"+i).val(l)}};$("#"+t).ympicker(a),$("#"+t).blur((function(){var a=$("#"+t).val();""!=a&&null!=a||($("#"+e).val(""),$("#"+i).val(""))}))}datepicker_ja(){jQuery.datepicker.regional.ja={closeText:"閉じる",prevText:"<前",nextText:"次>",currentText:"今日",monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayNames:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"],dayNamesShort:["日","月","火","水","木","金","土"],dayNamesMin:["日","月","火","水","木","金","土"],weekHeader:"週",dateFormat:"yy/mm/dd",firstDay:0,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"年"},jQuery.datepicker.setDefaults(jQuery.datepicker.regional.ja)}}function DateFormat(t,e){var i,a,r=e,n=new Array("日","月","火","水","木","金","土");return i="yyyy",r.indexOf(i)>-1&&(a=t.getFullYear(),r=r.replace(/yyyy/,a)),i="mm",r.indexOf(i)>-1&&(a=PadZero(t.getMonth()+1,2),r=r.replace(/mm/,a)),i="ddd",r.indexOf(i)>-1&&(a=n[t.getDay()],r=r.replace(/ddd/,a)),i="dd",r.indexOf(i)>-1&&(a=PadZero(t.getDate(),2),r=r.replace(/dd/,a)),i="hh",r.indexOf(i)>-1&&(a=PadZero(t.getHours(),2),r=r.replace(/hh/,a)),i="ii",r.indexOf(i)>-1&&(a=PadZero(t.getMinutes(),2),r=r.replace(/ii/,a)),i="ss",r.indexOf(i)>-1&&(a=PadZero(t.getSeconds(),2),r=r.replace(/ss/,a)),i="fff",r.indexOf(i)>-1&&(a=PadZero(t.getMilliseconds(),3),r=r.replace(/fff/,a)),r}function DateParse(t,e){var i,a,r="1990",n="01",l="01",s="00",o="00",h="00",d="000";return i="yyyy",(a=e.indexOf(i))>-1&&(r=t.substr(a,i.length)),i="MM",(a=e.indexOf(i))>-1&&(n=parseInt(t.substr(a,i.length),10)-1),i="dd",(a=e.indexOf(i))>-1&&(l=t.substr(a,i.length)),i="HH",(a=e.indexOf(i))>-1&&(s=t.substr(a,i.length)),i="mm",(a=e.indexOf(i))>-1&&(o=t.substr(a,i.length)),i="ss",(a=e.indexOf(i))>-1&&(h=t.substr(a,i.length)),i="fff",(a=e.indexOf(i))>-1&&(d=t.substr(a,i.length)),new Date(r,n,l,s,o,h,d)}function PadZero(t,e){return new Array(e-(""+t).length+1).join("0")+t}
/**
 * ファイルアップロードの拡張クラス
 * 
 * @note
 * DnD（ドラッグ&ドロップに対応。
 * アップロード区分のドレスアップ。
 * エンティティなどのデータも一緒に送信。
 * 複数のファイルをアップロードできる。
 * 複数のファイルアップロード要素に対応。
 * 進捗バーの表示
 * ファイルの初期表示
 * 
 * @license MIT
 * @version 1.3.1
 * @date 2018-7-6 | 2019-8-21
 * @history 
 *  - 2018-10-2 var 1.2.6 「Now Loading...」メッセージを表示する
 *  - 2018-9-18 var 1.2.5 コールバックパラメータを追加（pacb_param)
 *  - 2018-9-18 var 1.2.4 fuk_preview要素のstyle属性を修正
 *  - 2018-9-18 var 1.2.3 クリアのバグを修正
 *  - 2018-8-27 ver 1.2.2 setFilePaths:ファイル名空に対応
 *  - 2018-8-14 ver 1.2.0 ファイルの初期表示
 *  - 2018-8-11 ver 1.1
 *  - 2018-8-7 リリース
 *  - 2018-7-6 新規作成
 * 
 */class FileUploadK{constructor(t,e){null==e&&(e={}),this.callbacks=e,this.active_fue_id,this.box={},this.mimeMap=this._getMimeMapping(),this.param=this._setParamIfEmpty(t),this.unit=jQuery(this.param.unit_slt),this.cbAsynsEnd}_setParamIfEmpty(t){null==t&&(t={}),null==t.ajax_url&&(t.ajax_url=null),null==t.style_flg&&(t.style_flg=1),null==t.unit_slt&&(t.unit_slt="body"),null==t.err_slt&&(t.err_slt="#err"),null==t.fuk_msg_text&&(t.fuk_msg_text=""),null==t.valid_mime_flg&&(t.valid_mime_flg=0),null==t.img_width&&(t.img_width=null),null==t.img_height&&(t.img_height=null),null==t.adf&&(t.adf={fn_flg:1,size_flg:1,mime_flg:1,modified_flg:1});var e=null;return null!=t.valid_ext&&(e=t.valid_ext),t.validData=this._createValidData(e),t}addEvent(t,e){null==e&&(e={});var i=this._getElement(t,"label");i.attr("data-fue-id",t);var a=this._setToBox(t,this.box,e);this._addRelatedElements(i,t,a),this._applyStyle(t),i[0].addEventListener("drop",i=>{i.stopPropagation(),i.preventDefault();var a=i.dataTransfer.files;this.box[t].files=a,this._preview(t,"files",e),null!=this.callbacks.fileputEvent&&this.callbacks.fileputEvent(this.box)},!1),i[0].addEventListener("dragover",t=>{t.preventDefault()},!1),this._getElement(t,"fue").change(i=>{var a=i.target.files;null!=a&&0!=a.length&&(this.box[t].files=a,this._preview(t,"files",e),null!=this.callbacks.fileputEvent&&this.callbacks.fileputEvent(this.box))}),this._getElement(t,"clear_btn").click(t=>{this._clearBtnClick(t)})}setFilePaths(t,e,i){if(null==i&&(i={}),this._clearBtnAction(t),null!=e&&""!=e&&0!=e){"string"==typeof e&&(e=[e]),this._getElement(t,"fuk_msg").html("Now Loading ..");var a=[];i.pacb=()=>{this.box[t].bData=a,this._preview(t,"blob",i)},this._cbAsynsEndInit(e.length,i);var r="";for(var n in i.midway_dp&&(r=i.midway_dp),e){var l=r+e[n];this._preloadByXhr(l,a)}}}_preloadByXhr(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.onload=t=>{this._xhrOnload(t,i,e)},i.send()}_xhrOnload(t,e,i){var a=t.target.response,r=t.target.responseURL,n=this._stringRightRev(r,"/"),l=e.getResponseHeader("Content-Type"),s=e.getResponseHeader("Content-Length"),o=(e.getResponseHeader("server"),{fn:n,mime_type:l,size:s,modified:e.getResponseHeader("Last-Modified"),blob:a});i.push(o),this._cbAsynsEndAction("exe1")}_addRelatedElements(t,e,i){var a="";a+="<span class='fuk_msg'>"+i[e].fuk_msg_text+"</span>",a+="<span class='fuk_preview' style='display:inline-block'></span>",a+="<div class='fuk_clear_btn_w'><input type='button' value='Clear' class='btn btn-default btn-xs fuk_clear_btn' data-fue-id='"+e+"' /></div>",t.append(a)}_applyStyle(t){this.param.style_flg&&this._getElement(t,"label").addClass("fuk")}_preview(t,e,i){this._getElement(t,"fuk_msg").html("Now Loading ..."),this.active_fue_id=t;var a=null,r=null,n=[];if("files"==e){a=this.box[t].files;n=this._getFileDataFromFiles(a)}else{if("blob"!=e)throw new Error("Unknown 'bin_type'");r=this.box[t].bData,n=this._getFileDataFromBData(r)}if(!this._checkFnsEmpty(n)){this._getElement(t,"label").css({width:"auto",height:"auto"}),this._getElement(t,"clear_btn_w").show(),n=this._validCheck(t,n),this.box[t].fileData=n;var l="";for(var s in n){var o=n[s];l+=this._makeFileUnitHtml(t,o,i)}var h=this._getElement(t,"preview");h[0]&&h.html(l);var d={};if(h.children("div").each((t,e)=>{var i=(e=jQuery(e)).find(".fuk_rp");i[0]?d[t]=i:d[t]=null}),n=this._filteringFileData(n,d),"files"==e){for(var s in this._cbAsynsEndInit(n.length,i),n){var _=a[c=(o=n[s]).index];this._setupRender(_,d,c)}this._cbAsynsEndAction("exe2")}else if("blob"==e){for(var s in n){var c,p=r[c=(o=n[s]).index].blob,u=window.URL.createObjectURL(p);d[c].attr("src",u)}this._cbAsynsEndAction("exe2")}}}_checkFnsEmpty(t){for(var e in t){if(t[e].fn)return!1}return!0}_filteringFileData(t,e){var i=[];for(var a in t)if(null!=e[a]){var r=t[a];1!=r.err_flg&&null!=r.size&&0!=r.size&&(r.index=a,i.push(r))}return i}_setupRender(t,e,i){var a=new FileReader;a.readAsDataURL(t),a.onload=t=>{e[i].attr("src",a.result),this._cbAsynsEndAction("exe1")}}_getFileDataFromFiles(t){var e=[];for(var i in t){var a=t[i];if(null!=a.size){var r={},n=a.type;r.mime=n;var l="";null!=n&&(n.indexOf("image")>=0&&(l="image"),n.indexOf("audio")>=0&&(l="audio")),r.file_type=l;var s="";null!=a.name&&(s=a.name),r.fn=s,r.size=a.size;var o=0;null!=a.size&&(o=a.size),isNaN(o)||(o=this._convSizeUnit(o)),r.size_str=o;var h="";null!=a.lastModifiedDate&&(h=a.lastModifiedDate.toLocaleString()),r.modified=h,e.push(r)}}return e}_getFileDataFromBData(t){var e=[];for(var i in t){var a=t[i];if(null!=a.size&&0!=a){var r={};r.mime=a.mime_type;var n="";null!=r.mime&&(r.mime.indexOf("image")>=0&&(n="image"),r.mime.indexOf("audio")>=0&&(n="audio")),r.file_type=n,r.fn=a.fn,r.size=a.size;var l=0;null!=a.size&&(l=a.size),isNaN(l)||(l=this._convSizeUnit(l)),r.size_str=l;var s="";null!=a.modified&&(s=new Date(s).toLocaleString()),r.modified=s,e.push(r)}}return e}_validCheck(t,e){if(null==t)return e;var i=this.box[t].validData.validExts,a=!0;for(var r in null!=i&&0!=i||(a=!1),e){var n=e[r];if(0!=a){var l=n.fn;if(""!=l&&null!=l){var s=this._getExtension(n.fn);-1!=i.indexOf(s)?(n.err_flg=!1,n=this._validCheckMime(t,n)):(n.err_flg=!0,n.err_msg=l+"の拡張子は対象外です。")}else n.err_flg=!0,n.err_msg="ファイル名が空です。",n.fn_empty=!0}else n.err_flg=!1}return e}_getExtension(t){if(null==t)return"";var e=t.split("."),i=e[e.length-1];return i=i.toLowerCase()}_validCheckMime(t,e){if(0==this.param.valid_mime_flg)return e;if(1==e.err_flg)return e;var i=this.box[t].validData.validMimes,a=e.mime;return-1==i.indexOf(a)?(e.err_flg=!0,e.err_msg=e.fn+"のMIME("+a+")は対象外です。"):e.err_flg=!1,e}_makeFileUnitHtml(t,e,i){var a="";if(1==e.err_flg)return a="<div class='fuk_file_unit' >"+(a="<div class='fuk_err_msg'>"+e.err_msg+"</div>")+"</div>";var r=this._getImgSize(t,i),n=r.width,l=r.height;"image"==e.file_type?a+="<img src='' class='fuk_rp' style='width:"+n+"px;height:"+l+"px;' />":"audio"==e.file_type&&(a+="<audio src='' class='fuk_rp' controls />");var s=this.param.adf,o=[{label:"ファイル名",val:e.fn,flg:s.fn_flg},{label:"サイズ",val:e.size_str,flg:s.size_flg},{label:"MIME",val:e.mime,flg:s.mime_flg},{label:"更新日",val:e.modified,flg:s.modified_flg}];for(var h in o){var d=o[h];1==d.flg&&(a+="<div><label class='fuk_param_label'>"+d.label+"</label><val class='fuk_param_val'>"+d.val+"</val></div>")}return a="<div class='fuk_file_unit' >"+a+"</div>"}_getImgSize(t,e){return{width:e.img_width?e.img_width:this.param.img_width?this.param.img_width:this.box[t].label_width?this.box[t].label_width:160,height:e.img_height?e.img_height:this.param.img_height?this.param.img_height:this.box[t].label_height?this.box[t].label_height:160}}_clearBtnClick(t){var e=jQuery(t.currentTarget).attr("data-fue-id");this._clearBtnAction(e)}_clearBtnAction(t){this._getElement(t,"clear_btn_w").hide();var e=this._getElement(t,"fue");e.val(""),e.attr("data-fp","");var i=this._getElement(t,"fuk_msg"),a=this.box[t].fuk_msg_text;i.html(a),i.show(),this._getElement(t,"preview").html("");var r=this.box[t].label_width,n=this.box[t].label_height,l=this._getElement(t,"label");"block"==l.css("display")&&(l.width(r),l.height(n)),this.box[t].fileData=[]}_cbAsynsEndInit(t,e){var i=function(){};null!=e.pacb&&(i=e.pacb);var a={};null!=e.pacb_param&&(a=e.pacb_param),this.cbAsynsEndData={index:0,count:t,callback:i,cbParam:a}}_cbAsynsEndAction(t){switch(t){case"exe1":(e=this.cbAsynsEndData).index==e.count-1?null!=e.callback&&(e.callback(this.active_fue_id,this.box,e.cbParam),this._endPreview()):e.index++;break;case"exe2":var e;0==(e=this.cbAsynsEndData).count&&null!=e.callback&&(e.callback(this.active_fue_id,this.box,e.cbParam),this._endPreview())}}_endPreview(){this._getElement(this.active_fue_id,"fuk_msg").hide()}uploadByAjax(t,e,i){var a=this.param,r=new FormData,n=0;for(var l in this.box){var s=this.box[l].files,o=this.box[l].fileData;for(var h in o){0==o[h].err_flg&&(r.append(n,s[h]),n++)}}e=this._escapeForAjax(e);var d=JSON.stringify(e);r.append("key1",d);var _=null;a.prog_slt&&(_=this.unit.find(a.prog_slt)),jQuery.ajax({type:"POST",url:a.ajax_url,data:r,cache:!1,dataType:"text",processData:!1,contentType:!1,xhr:()=>{var t=jQuery.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",t=>{if(_){var e=parseInt(t.loaded/t.total*1e4)/100;_.val(e)}},!1),t}}).done((e,i)=>{var a;try{a=jQuery.parseJSON(e)}catch(t){return void jQuery(this.param.err_slt).html(e)}t(a)}).fail((t,e,i)=>{var a=t.responseText;console.log(a),jQuery(this.param.err_slt).html(a),alert(e)})}getFileParams(){var t=[];for(var e in this.box){var i=this.box[e].files,a={};for(var r in i){var n=i[r];null!=n.size&&(a.fu_id=e,a.name=n.name,a.size=n.size,a.mime=n.type,a.modified=n.lastModifiedDate.toLocaleString(),t.push(a))}}return t}_getElement(t,e){var i=this.box;if(null==i[t]&&(i[t]={}),"fue"==e){var a=null;return i[t].fue?a=i[t].fue:(a=this.unit.find("#"+t),i[t].fue=a),a}if("label"==e){a=null;if(i[t].label)a=i[t].label;else{var r=this._getElement(t,"fue");if(null==r)return null;a=r.parents("label"),i[t].label=a}return a}if("fuk_msg"==e){a=null;if(i[t].fuk_msg)a=i[t].fuk_msg;else{if(null==(n=this._getElement(t,"label")))return null;a=n.find(".fuk_msg"),i[t].fuk_msg=a}return a}if("preview"==e){a=null;if(i[t].preview)a=i[t].preview;else{if(null==(n=this._getElement(t,"label")))return null;a=n.find(".fuk_preview"),i[t].preview=a}return a}if("clear_btn"==e){a=null;if(i[t].clear_btn)a=i[t].clear_btn;else{if(null==(n=this._getElement(t,"label")))return null;a=n.find(".fuk_clear_btn"),i[t].clear_btn=a}return a}if("clear_btn_w"==e){a=null;if(i[t].clear_btn_w)a=i[t].clear_btn_w;else{var n;if(null==(n=this._getElement(t,"label")))return null;a=n.find(".fuk_clear_btn_w"),i[t].clear_btn_w=a}return a}return null}_setToBox(t,e,i){null==i&&(i={});var a={};e[t]&&(a=e[t]);var r=this._getElement(t,"label");a.label_width=r.width(),a.label_height=r.height();var n="";if(this.param.fuk_msg_text)n=this.param.fuk_msg_text;else{var l=this._getElement(t,"fue").attr("title");n=l||"File Upload"}return a.fuk_msg_text=n,null==i.valid_ext?a.validData=this.param.validData:a.validData=this._createValidData(i.valid_ext),e[t]=a,e}_convSizeUnit(t,e){null==e&&(e=1);return t<1e3?t+"Byte":t<Math.pow(10,6)?(t=Math.round(t*Math.pow(10,e-3))/Math.pow(10,e))+"KB":t<Math.pow(10,9)?(t=Math.round(t*Math.pow(10,e-6))/Math.pow(10,e))+"MB":t<Math.pow(10,12)?(t=Math.round(t*Math.pow(10,e-9))/Math.pow(10,e))+"GB":(t=Math.round(t*Math.pow(10,e-12))/Math.pow(10,e))+"TB"}_createValidData(t){var e={validExts:[],validMimes:[]};if(null==t||""==t)return e;var i=[];for(var a in i=Array.isArray(t)?t:"image"==t?["jpg","jpeg","png","gif","bpg"]:"audio"==t?["mp3","wav"]:t.split(","))i[a]=i[a].trim();i=this._array_unique(i);var r=this._getValidMimes(i);return e.validExts=i,e.validMimes=r,e}_array_unique(t){return t.filter((function(t,e,i){return i.indexOf(t)===e}))}_getValidMimes(t){var e=this.mimeMap,i=[];for(var a in t){var r=t[a],n="";null!=e[r]&&(n=e[r]),i.push(n)}return i}getFileNames(t){var e=[];if(null==t)for(var t in this.box){var i=this.box[t].fileData;for(var a in i){var r=i[a];e.push(r.fn)}}else{i=this.box[t].fileData;for(var a in i){r=i[a];e.push(r.fn)}}return e}_getMimeMapping(){var t={aac:"audio/aac",abw:"application/x-abiword",arc:"application/octet-stream",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bpg:"image/bpg",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",es:"application/ecmascript",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",mid:"audio/midi audio/x-midi",midi:"audio/midi audio/x-midi",mp3:"audio/mp3",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",otf:"font/otf",png:"image/png",pdf:"application/pdf",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/x-rar-compressed",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"application/typescript",ttf:"font/ttf",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"};return t}_escapeForAjax(t){if("string"==typeof t)return-1!=t.indexOf("&")?(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),encodeURIComponent(t)):t;if("object"==typeof t){for(var e in t)t[e]=this._escapeForAjax(t[e]);return t}return t}_stringRightRev(t,e){if(null==t||""==t)return t;var i=t.lastIndexOf(e);return t.substring(i+e.length,t.length)}}class FoldingTa{init(t){t=this._setParamIfEmpty(t),this.param=t,this.formElm=jQuery(t.form_slt);var e=this._initBoxs();e=this._addPreviewElms(e),this._addEventTenkaiClick(e),this.boxs=e}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.form_slt)throw new Error("Empty 'form_slt' !");return null==t.midasi_length&&(t.midasi_length=20),t}_initBoxs(){var t=[];return this.formElm.find("[data-folding-ta]").each((e,i)=>{var a=jQuery(i),r=a.attr("data-folding-ta");null!=r&&""!=r||(r=this.param.midasi_length);var n={taElm:a,midasi_len:r};t.push(n)}),t}_getMidasiText(t,e){if(""==t|null==t)return"";var i="";return i=t.length>this.param.midasi_length?t.substring(0,e):t,i=this._xss_sanitize(i)}_addPreviewElms(t){for(var e in t){var i=t[e],a=i.taElm,r=`\n\t\t\t\t<div class="folding_ta_preview" data-folding-ta-p-i="${e}" ">\n\t\t\t\t\t<div class="folding_ta_midasi" style="display:inline-block;margin-right:5px">${this._getMidasiText(a.val(),i.midasi_len)}</div>\n\t\t\t\t\t<input type="button" value='...' class="folding_ta_tenkai btn btn-default btn-xs" data-folding-ta-p-i="${e}" style="margin-top:0px" />\n\t\t\t\t</div>\n\t\t\t`;a.before(r)}return this.formElm.find(".folding_ta_preview").each((e,i)=>{var a=jQuery(i),r=a.attr("data-folding-ta-p-i"),n=t[r];n.previewElm=a;var l=a.find(".folding_ta_midasi");n.midasiElm=l;var s=a.find(".folding_ta_tenkai");n.tenkaiElm=s}),t}_addEventTenkaiClick(t){for(var e in t){var i=t[e];i.tenkaiElm.click(t=>{var e=jQuery(t.currentTarget);this.clickTenkai(e)}),i.taElm.hide()}}clickTenkai(t){var e=t.attr("data-folding-ta-p-i"),i=this.boxs[e];if("none"==i.taElm.css("display"))i.taElm.show(),i.midasiElm.hide(),i.tenkaiElm.attr("value","閉じる");else{var a=this._getMidasiText(i.taElm.val(),i.midasi_len);i.midasiElm.html(a),i.taElm.hide(),i.midasiElm.show(),i.tenkaiElm.attr("value","...")}}reflection(){for(var t in this.boxs){var e=this.boxs[t],i=e.taElm.val(),a=this._getMidasiText(i,e.midasi_len);e.midasiElm.html(a)}}_xss_sanitize(t){if("object"==typeof t){for(var e in t)t[e]=this._xss_sanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}}function imgCompactK(){$(".img_compact_k").each((function(){$(this).attr("class",""),$(this).css({width:"160px",height:"160px"}),$(this).click((function(){"160px"==$(this).css("width")?($(this).attr("class","img-responsive"),$(this).css({width:"auto",height:"auto"})):($(this).attr("class",""),$(this).css({width:"160px",height:"160px"}))}))}))}$((function(){imgCompactK()}));var ImportFu=function(t){this.param=t,this.fu_wrap,this.files;var e=this;function i(t){var i=e.param;!function(){var t=e.param;e.fu_wrap.find("#"+t.preview_xid).hide(),e.fu_wrap.find(".loding_gif").show()}();var r=t[0];if(null!=r){var l=new FileReader;l.readAsDataURL(r),l.onload=function(t){var r=function(){var t=e.param.fw,i=e.param.ajax_url;if(""==t&&""!=i)return i;if(""==t&&""==i)throw new Error("Empty ajax_url !");if("wp"==t&&""!=i)return i;if("wp"==t&&""==i)return jQuery("#admin-ajax-url").val()}(),l=i.fu_slt,o=new FormData;o.append("upload_file",jQuery(l).prop("files")[0]),"wp"==i.fw&&(o=function(t,e){var i=jQuery("#nonce").val();return t.append("action",e),t.append("nonce",i),t}(o,i.wp_ajax_action)),jQuery.ajax({type:"POST",url:r,data:o,cache:!1,dataType:"text",processData:!1,contentType:!1}).done((function(t,r){var l,o;try{s((l=JSON.parse(t)).err_msg)?((o=jQuery("#"+e.param.suc_msg_xid)).show(),0!=e.param.suc_toggle_sec&&o.fadeOut(e.param.suc_toggle_sec),s(i.success_callback)||i.success_callback(l)):jQuery("#"+i.err_xid).html(l.err_msg),n(),a()}catch(e){throw console.log(t),jQuery("#"+i.err_xid).html(t),n(),a(),e}})).fail((function(t,e,a){console.log(t);var r=t.responseText;console.log(r),jQuery("#"+i.err_xid).html(r),alert(e),n()}))}}}function a(){e.files=null,e.fu_wrap.find(".imp_fu_caption").show();var i=e.fu_wrap.find("#"+t.preview_xid);i.find(".imp_fu_pre_fn").html(""),i.hide();var a=e.param.fu_slt;jQuery(a).val("")}function r(t){var i=e.param,a=e.fu_wrap.find("#"+i.preview_xid);a.show();var r=a.find(".imp_fu_pre_fn"),n=t[0].name;r.html(n),e.fu_wrap.find(".imp_fu_caption").hide(),e.files=t,jQuery("#"+e.param.suc_msg_xid).hide()}function n(){e.fu_wrap.find(".loding_gif").hide()}function l(t){var e=t,i=e.charAt(0);return"#"!=i&&"."!=i||(e=e.substr(1)),e}function s(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}this.constract=function(){this.param=function(t){null==t&&(t={});if(null==t.fu_slt)throw new Error("The fu_slt in param is empty!");var e=l(t.fu_slt);null==t.ajax_url&&(t.ajax_url="");null==t.preview_flg&&(t.preview_flg=1);null==t.caption&&(t.caption="File upload");null==t.caption_color&&(t.caption_color="#a698c9");null==t.caption_color2&&(t.caption_color2="#FFFFFF");null==t.back_color&&(t.back_color="#e3dfee");null==t.caption_font_size&&(t.caption_font_size="40px");null==t.backimg_fp&&(t.backimg_fp="");null==t.wrap_xid&&(t.wrap_xid=e+"_wrap");null==t.fw&&(t.fw="");if(null==t.wp_ajax_action){if("wp"==t.fw)throw Error("The wp_ajax_action in param is empty! (WordPress only)");t.wp_ajax_action=""}null==t.success_callback&&(t.success_callback=null);null==t.suc_msg_xid&&(t.suc_msg_xid=e+"_suc_msg");null==t.suc_msg&&(t.suc_msg="読込が終わりました。");null==t.suc_toggle_sec&&(t.suc_toggle_sec=3e3);null==t.fuWrapCss&&(t.fuWrapCss={"background-color":t.back_color,"border-radius":"5px",display:"inline-block"});null==t.label_xid&&(t.label_xid=e+"_label");null==t.caption_xid&&(t.caption_xid=e+"_caption");null==t.preview_xid&&(t.preview_xid=e+"_preview");if(null==t.captionCss){var i=t.caption_color,a=t.caption_color2,r=t.caption_font_size;t.captionCss={padding:"0px 20px 0px 20px",color:a,"font-size":r,"font-weight":"bold","text-shadow":"2px 2px 1px "+i+",-2px 2px 1px "+i+",2px -2px 1px "+i+",-2px -2px 1px "+i}}null==t.err_xid&&(t.err_xid=e+"_err");return t}(this.param),function(t){var r=t.fu_slt,n=jQuery(r),o=l(r);n.hide(),n.wrap("<div id='"+t.wrap_xid+"'  ><label id = '"+t.label_xid+"' for='"+o+"' ></label></div>");var h=jQuery("#"+t.wrap_xid);h.css(t.fuWrapCss);var d=h.find("#"+t.label_xid),_="<div id='"+t.caption_xid+"' class='imp_fu_caption'>"+t.caption+"</div>";if(d.append(_),h.find("#"+t.caption_xid).css(t.captionCss),!s(t.backimg_fp)){var c="<img src='"+t.backimg_fp+"' />";h.append(c)}var p="<div id='"+t.preview_xid+"' style='display:none;margin:0px 20px 20px 20px;'>\t<div id='"+t.pre_fn_xid+"' class='imp_fu_pre_fn'></div>\t<div class='imp_fu_pre_btns' style='margin-top:10px'>\t\t<input type='button' class='imp_fu_pre_exe_btn btn btn-success btn' value='アップロード' />\t\t<input type='button' class='imp_fu_pre_cancel_btn btn btn-default btn' value='キャンセル' />\t</div></div>";h.append(p);h.append("<div class='loding_gif' style='display:none;padding:20px;'>\t<img src='data:image/gif;base64,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' /> 読み込み中・・・</div>"),h.find(".imp_fu_pre_exe_btn").click((function(t){i(e.files)})),h.find(".imp_fu_pre_cancel_btn").click((function(t){a()}));var u="<div id='"+t.suc_msg_xid+"' class='text-success' style='display:none'>"+t.suc_msg+"</div>";h.after(u);var m="<div id='"+t.err_xid+"' class='text-danger' ></div>";h.after(m),e.fu_wrap=h}(this.param),function(t){jQuery(t.fu_slt).change((function(e){var a=e.target.files;t.preview_flg?r(a):i(a)}))}(this.param),function(t){var e=jQuery("#"+t.wrap_xid);e[0].addEventListener("drop",(function(e){e.stopPropagation(),e.preventDefault();var a=e.dataTransfer.files;t.preview_flg?r(a):i(a)}),!1),e[0].addEventListener("dragover",(function(t){t.preventDefault()}),!1)}(this.param)},this.constract()};function errShowDetail(){if($("#err")[0]&&$("#detail_div")[0]){var t=$("#err").html();""!=(t=t.trim())&&$("#detail_div").show()}}function resetKjs(t){null==t&&(t=[]);var e=$("#def_kjs_json").val(),i=$.parseJSON(e);for(var a in i)t.indexOf(a)<0&&$("#"+a).val(i[a])}function moveClmSorterBase(t){var e=csh.getCshAry(),i=null;i=0==e.length?$("#csh_json").val():JSON.stringify(e);var a=encodeURIComponent(i),r=$("#webroot").val()+"clm_sorter?p="+t+"&csh_u="+a;location.href=r}function loadSvg(t,e){$(e+":empty").load(t,(function(){}))}function toggleSvg(t,e){loadSvg(t,e);var i=$(e);"none"==i.css("display")?i.show():i.hide()}function linkByRowdata(t,e,i){null==i&&(i="id");var a=(t=$(t)).parents("tr").find("."+i).text();e=e.replace("%0",a),location.href=e}$((function(){errShowDetail()})),$((function(){(new LiviPage).execution({width:"auto"})}));var LiviPage=function(){this.execution=function(t){$(document.body).append("<div id='livipage_tooltip'></div>");var e={"z-index":2,"background-color":"white",position:"absolute",border:"solid 2px #ccb1bf",padding:"5px",width:"280px",height:"460px","overflow-y":"auto"};null!=t&&$.extend(e,t),$(document).click((function(){$("#livipage_tooltip").hide()})),$("#livipage_tooltip").click((function(t){t.stopPropagation()})),$(".livipage").click((function(){var t=$(this).attr("href"),i=$(this).offset(),a=i.left,r=i.top,n=($(t).width(),$(t).height(),$(t).html());n="<a href='"+t+"'>"+$(this).html()+"</a><br>"+n,$("#livipage_tooltip").show(),$("#livipage_tooltip").css(e),$("#livipage_tooltip").html(n);var l=a,s=r+16;return $("#livipage_tooltip").offset({top:s,left:l}),!1}))}},NoUiSliderWrap=function(){this.props,this.slider,this.init=function(t,e){this.props=e;var i=$(e.slider).get(0);this.slider=i;var a=$(e.tb1).val(),r=$(e.tb2).val();noUiSlider.create(i,{start:[a,r],step:e.step,connect:!0,tooltips:!1,range:{min:e.min,max:e.max}}),i.noUiSlider.on("update",(function(t,i){var a=t[0],r=(a=Math.round(a),t[1]);r=Math.round(r);0!=a||0!=r?($(e.tb1).val(a),$(e.tb2).val(r),$(e.value_preview).html(a+"～"+r)):($(e.tb1).val(""),$(e.tb2).val(""),$(e.value_preview).html("OFF"))})),$(e.tb1).blur((function(e){t.reload()})),$(e.tb2).blur((function(e){t.reload()}))},this.reload=function(){var t=$(this.props.tb1).val(),e=$(this.props.tb2).val();this.slider.noUiSlider.set([t,e])}};
/**
 * ページネーションジャンプ
 * 
 * @note
 * ページネーションにジャンプ機能を付ける
 * 
 * 使い方
 * 下記のような要素をHTMLに埋め込む
 * <div class="pagenation_jump" data-count="1271" data-hina-url="/animal_park/neko?page_no=1&row_limit=50&sort_field=Neko.sort_no&sort_desc=0&act_flg=2&kj_delete_flg=0&row_limit=50" style="display:inline-block"></div>
 * 
 * @date 2019-7-26
 * @license MIT
 * @version 1.0.0
 */
class PagenationJump{init(t){if(this.param=this._setParamIfEmpty(t),this.tDiv=jQuery("#"+this.param.xid),!this.tDiv[0])return;let e=this._createHtml();this.tDiv.html(e),this.showBtn=this.tDiv.find(".cbpjump_show_btn"),this.div1=this.tDiv.find(".cbpjump_div1"),this.tb=this.tDiv.find(".cbpjump_tb"),this.jumpBtn=this.tDiv.find(".cbpjump_jump_btn");let i=this.tDiv.attr("data-row-limit"),a=this.tDiv.attr("data-count"),r=1;this._empty(i)||(r=Math.ceil(a/i));let n=this.tDiv.attr("data-hina-url");this._empty(n)||(n=n.replace(/page_no=[0-9]*/g,"page_no=%0"),this.param.row_limit=i,this.param.data_count=a,this.param.max_page_count=r,this.param.hina_url=n,this.addClickShowBtn(this.showBtn),this.addClickJumpBtn(this.jumpBtn),this.addEnterTb(this.tb))}_setParamIfEmpty(t){return null==t&&(t={}),null==t.xid&&(t.xid="pagenation_jump"),t}_createHtml(){return'\n\t<button class="cbpjump_show_btn btn btn-default btn-xs" title="ページジャンプ">\n\t\t\t<span class="glyphicon glyphicon-hand-up"></span>\n\t</button>\n\t<div style="display:inline-block">\n\t\t<div class="cbpjump_div1" style="margin-right:16px;display:none">\n\t\t\t<input class="cbpjump_tb" type="textbox" style="width:60px">\n\t\t\t<input class="cbpjump_jump_btn btn btn-warning btn-xs" type="button" value=\'ページジャンプ\' />\n\t\t</div>\n\t</div>\n\t\t'}addClickShowBtn(t){t.click(t=>{this._clickShowBtn()})}_clickShowBtn(){this.div1.toggle(100)}addClickJumpBtn(t){t.click(t=>{this._clickJumpBtn()})}_clickJumpBtn(){let t=this.tb.val();if(t+="",""==(t=(t=this._toHalfWidth(t)).trim())||null==t)return void alert("ページ番号を入力してください");if(isNaN(t))return void alert("ページ番号は数値を入力してください");(t*=1)<1&&(t=1),t>this.param.max_page_count&&(t=this.param.max_page_count),t-=1;let e=this.param.hina_url;e=e.replace("%0",t),location.href=e}addEnterTb(t){t.keypress(t=>{13==t.which&&this._clickJumpBtn()})}_toHalfWidth(t){return t.replace(/[Ａ-Ｚａ-ｚ０-９！-～]/g,t=>String.fromCharCode(t.charCodeAt(0)-65248))}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}var ProcessWithMultiSelection=function(t){this.param=t;var e=this;function i(t,e){var i=t.find("[name='"+e+"']");return i[0]||(i=t.find("."+e)),i}this.constract=function(){this.param=function(t){null==t&&(t={});null==t.tbl_slt&&(t.tbl_slt="tbl1");null==t.cb_slt&&(t.cb_slt="pwms");null==t.id_slt&&(t.id_slt="id");if(null==t.ajax_url)throw new Error("'ajax_url' is nothing");return t}(this.param)},this.action=function(t){var a=function(){var t=[],a=e.param.tbl_slt+" tbody tr";return $(a).each((function(){var a=$(this);if(i(a,e.param.cb_slt).prop("checked")){var r=function(t,e){var i=void 0,a=t.find("[name='"+e+"']");a[0]?i=a.val():(a=t.find("."+e))[0]&&(i=a.text());return i}(a,e.param.id_slt);t.push(r)}})),t}();if(0!=a.length){if("11"==t)if(!confirm("チェックした行を削除してもよろしいですか？"))return;var r={ids:a,kind_no:t},n=JSON.stringify(r);$.ajax({type:"POST",url:e.param.ajax_url,data:"key1="+n,cache:!1,dataType:"text",success:function(t,e){"success"==t?location.reload(!0):$("#err").html(t)},error:function(t,e,i){$("#err").html(t.responseText),alert(e)}})}},this.switchAllSelection=function(t){var a=$(t).prop("checked"),r=e.param.tbl_slt+" tbody tr";$(r).each((function(){i($(this),e.param.cb_slt).prop("checked",a)}))},this.constract()};class PwValidK{check(t,e){if(null==t||""==t||0==t)return{check:!1,err_msg:"パスワードが空です。"};if(null==e&&(e={}),null==e.num_req&&(e.num_req=!1),null==e.alph_req&&(e.alph_req=!0),null==e.min_len&&(e.min_len=8),null==e.max_len&&(e.max_len=32),t.length<e.min_len)return{check:!1,err_msg:"パスワードは"+e.min_len+"文字以上にしてください。"};if(t.length>e.max_len)return{check:!1,err_msg:"パスワードは"+e.max_len+"文字以下にしてください。"};var i;if(null==(i=t.match(/^[a-zA-Z0-9]+$/)))return{check:!1,err_msg:"パスワードは半角英数字で入力してください。"};if(e.num_req&&null==(i=t.match(/[0-9]/)))return{check:!1,err_msg:"パスワードに数字を含めてください。"};if(e.alph_req&&null==(i=t.match(/[a-zA-Z]/)))return{check:!1,err_msg:"パスワードにアルファベットを含めてください。"};return i=null==i?{check:!1,err_msg:"パスワードの入力エラー"}:{check:!0,err_msg:""}}}
/**
 * 年月による日付範囲入力 | RangeYm.js
 * @date 2019-8-17 | 2019-8-18
 * @license MIT
 * @version 1.1.4
 */class RangeYm{init(t){this.param=this._setParamIfEmpty(t),this.param.div_xid instanceof jQuery?(this.tDiv=this.param.div_xid,this.param.div_xid=this.tDiv.attr("id")):this.tDiv=jQuery("#"+this.param.div_xid);let e=this._createHtml();this.tDiv.html(e),this.ymTb=this.tDiv.find(".range_ym_tb"),this.dtlBtn=this.tDiv.find(".range_ym_dtl_btn"),this.rngDiv=this.tDiv.find(".range_ym_range_div"),this.fromInp=this.tDiv.find(".range_ym_date_from"),this.toInp=this.tDiv.find(".range_ym_date_to"),this.errElm=this.tDiv.find(".range_ym_err"),this.rngDiv.hide(),this._addClickDtlBtn(this.dtlBtn),this._addChangeYmTb(this.ymTb),this.param.def_ym=this.tDiv.attr("data-def-ym"),this.param.def1=this.tDiv.attr("data-def1"),this.param.def2=this.tDiv.attr("data-def2"),this.setYm(this.param.def_ym,this.param.def1,this.param.def2)}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.div_xid)throw new Error("div_xid is empty");if(null==t.field)throw new Error("field is empty");if(null==t.wamei)throw new Error("wamei is empty");return null==t.field_from&&(t.field_from=t.field+"1"),null==t.field_to&&(t.field_to=t.field+"2"),t}_getProperty(t,e,i,a){let r=null;return r=null!=a[t]?a[t]:null!=i[t]?i[t]:e}_createHtml(){let t=this.param.field,e=this.param.wamei,i=this.param.field_from,a=this.param.field_to;return`\n\t<input type="month" id="${t}_ym" class="range_ym_tb"  placeholder="「${e}」の年月" title="年月を選択すると「>」ボタンの先にその月の日付範囲が入力されます。" />\t\n\t<button type="button" class="range_ym_dtl_btn btn btn-default btn-xs" title="日付を範囲入力する部分を表示します。"><span class="glyphicon glyphicon-chevron-right"></span></button>\n\t<div class="range_ym_range_div" style="display:inline-block">\n\t\t<input type="date" id="${i}" class="${i} kjs_inp range_ym_date_from "  placeholder="「${e}」の範囲【始め】" title="「${e}」範囲の始め日付です。" />\t\n\t\t<input type="date" id="${a}" class="${a} kjs_inp range_ym_date_to "  placeholder="「${e}」の範囲【終わり】" title="「${e}」範囲の終わり日付です。" />\t\n\t\t<div class="range_ym_err text-danger"></div>\n\t</div>\n\t\t`}_showErr(t){this.errDiv.append(t+"<br>")}_addClickDtlBtn(t){t.click(t=>{this._toggleRngDiv()})}_toggleRngDiv(){var t=this.rngDiv.css("display");if(null==t|"none"==t){let t=this._getDtlBtnName(0);this.dtlBtn.val(t),this.tDiv.css("display","block"),this.rngDiv.show(100)}else{let t=this._getDtlBtnName(1);this.dtlBtn.val(t),this.tDiv.css("display","inline-block"),this.rngDiv.hide(100)}}_getDtlBtnName(t){let e=this.dtlBtn.val();return 1==t?e=e.replace(" (閉じる)",""):e+=" (閉じる)",e}_addChangeYmTb(t){t.change(t=>{let e=jQuery(t.currentTarget);this.changeYmTb(e)})}changeYmTb(t){let e=t.val()+"-01";this.fromInp.val(e);let i=this._getMonthEndDate(e);this.toInp.val(i)}_getMonthEndDate(t){if(null==t)return null;"string"==typeof t&&(t=new Date(t));var e=new Date(t.getFullYear(),t.getMonth()+1,0),i=e.getFullYear(),a=e.getMonth()+1,r=e.getDate();return i+"-"+(a=("0"+a).slice(-2))+"-"+(r=("0"+r).slice(-2))}setYm(t,e,i){t=this._yyyymm(t),this.ymTb.val(t);let a=!1;this._empty(e)?e=this._empty(t)?"":t+"-01":a=!0,e=this._yyyymmdd(e),this.fromInp.val(e),this._empty(i)?i=this._empty(t)?"":this._getMonthEndDate(e):a=!0,i=this._yyyymmdd(i),this.toInp.val(i),a&&this._toggleRngDiv()}_yyyymmdd(t,e){if(null==t)return t;if(""==(t=t.trim())||0==t)return t;null==e&&(e="-");let i=t.split(e);if(3!=i.length)return t;let a=i[1];a=("0"+a).slice(-2);let r=i[2];return r=("0"+r).slice(-2),i[0]+e+a+e+r}_yyyymm(t,e){if(null==t)return t;if(""==(t=t.trim())||0==t)return t;null==e&&(e="-");let i=t.split(e);if(2!=i.length)return t;let a=i[1];return a=("0"+a).slice(-2),i[0]+e+a}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}
/**
 * 年月による日付範囲入力【拡張】 | RangeYmEx.js
 * 
 * @note
 * RangeYm.jsが必要。
 * 
 * @date 2019-8-17
 * @license MIT
 * @version 1.0.0
 */class RangeYmEx{init(t){let e={};jQuery(".range_ym_ex").each((t,i)=>{let a=(i=jQuery(i)).attr("id"),r=i.attr("data-field"),n=i.attr("data-wamei");null==r&&(r=a);let l=new RangeYm;l.init({div_xid:i,field:r,wamei:n});let s={elm:i,field:r,wamei:n,rngYmObj:l};e[r]=s}),this.boxs=e}}class ReqBatch{init(t){t=this._setParamIfEmpty(t),this.tDiv=jQuery("#"+t.div_xid),this.startBtn=jQuery("#"+t.start_btn_xid),this.handlers=[],this.param=t}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.div_xid&&(t.div_xid="req_batch_div"),null==t.start_btn_xid&&(t.start_btn_xid="req_batch_start_btn"),null==t.interval&&(t.interval=1e3),null==t.ajax_url&&null==t.asyn_cb)throw new Error("Empty 'ajax_url' and 'asyn_cb' !");return null==t.fail_limit&&(t.fail_limit=5),null==t.asyn_param&&(t.asyn_param=null),t}start(t){this.data=t;var e=this._createHtml();this.tDiv.html(e),this.tDiv.show(),this.successDiv=this.tDiv.find(".req_batch_success"),this.reloadBtn=this.tDiv.find(".req_batch_reload"),this.errDiv=this.tDiv.find(".req_batch_err"),this.prog=this.tDiv.find(".req_batch_prog"),this.stopBtn=this.tDiv.find(".req_batch_stop_btn"),this.failBtn=this.tDiv.find(".req_batch_fail_btn"),this.consoleDiv=this.tDiv.find(".req_batch_console"),this.cCountDiv=this.tDiv.find(".req_batch_c_count"),this.cSuccessDiv=this.tDiv.find(".req_batch_c_success_count"),this.cFailDiv=this.tDiv.find(".req_batch_c_fail_count"),this.cMemDiv=this.tDiv.find(".req_batch_c_mem"),this.failDiv=this.tDiv.find(".req_batch_fail"),this._addReloadClickEvent(this.reloadBtn),this._addStopClickEvent(this.stopBtn),this._addFailBtnClickEvent(this.failBtn),this.mems=this._resetMemoryData(),this.prog.show(),this.prog.val(0),this.startBtn.hide(),this.main_index=0,this.asyn_flg=0,this.data_num=this.data.length,this.success_count=0,this.fail_count=0,this.ic_start_time=Math.floor($.now());var i=setInterval(()=>{this.thread()},this.param.interval);this.handlers.push(i)}_createHtml(){return'\n\t<div>\n\t\t<div class="req_batch_success text-success"></div>\n\t\t<input type="button" class="req_batch_reload btn btn-success btn-xs" value="リロード" style="display:none"> \n\t</div>\n\t<div class="req_batch_err text-danger"></div>\n\t<div><progress class="req_batch_prog"  max="100" style="display:none">■</progress></div>\n\t<div class="btn-group">\n\t\t<input type="button" value="停止" class="req_batch_stop_btn btn btn-default btn-xs"/>\n\t\t<input type="button" value="失敗(0)" class="req_batch_fail_btn btn btn-default btn-xs"/>\n\t</div>\n\t<br>\n\t<div class="req_batch_console console">\n\t\t<div><span>処理数:</span><span class="req_batch_c_count"></span></div>\n\t\t<div><span>成功:</span><span class="req_batch_c_success_count">0</span></div>\n\t\t<div><span>失敗:</span><span class="req_batch_c_fail_count">0</span></div>\n\t\t<div style="width:100%;font-size:0.8em"><span>メモリチェック:</span><span class="req_batch_c_mem"></span></div>\n\t</div>\n\t<div class="req_batch_fail text-danger" style="display:none"></div>\n\t\t'}_addReloadClickEvent(t){t.click(t=>{location.reload(!0)})}_addStopClickEvent(t){t.click(t=>{this.stopThread(),this.startBtn.show()})}_addFailBtnClickEvent(t){t.click(t=>{this.failDiv.toggle(300)})}thread(){if(0==this.asyn_flg){if(this._showCCount(),this._advanceProg(),this.ic_start_time=Math.floor($.now()),this.data_num==this.main_index)return void this._endProcessing();if(this.asyn_flg=1,this.param.asyn_cb){var t=this.data[this.main_index];this.param.asyn_cb(this.main_index,t,this.param.asyn_param)}else this._asynForInner();this.main_index++,this._showMemory()}}_showCCount(){var t=this.main_index+"/"+this.data_num;this.cCountDiv.html(t)}_advanceProg(){var t=this.main_index/this.data_num*100;this.prog.val(t)}_endProcessing(){this.prog.hide(),this.successDiv.html("すべての処理が終わりました。"),this._showCCount(),this.stopThread(),this.reloadBtn.show(),this.param.complete_cb&&this.param.complete_cb()}_asynForInner(){var t=this.data[this.main_index],e=JSON.stringify(t);jQuery.ajax({type:"POST",url:this.param.ajax_url,data:"key1="+e,cache:!1,dataType:"text"}).done((t,e)=>{var i;try{i=jQuery.parseJSON(t)}catch(e){return void this.asynFail(t)}this.asynSuccess(i)}).fail((t,e,i)=>{this.errDiv.html(t.responseText),alert(e)})}asynFail(t){this.asyn_flg=0,this._addFail(this.main_index,t),this._showFailCount(),this._checkFailLimit()}asynSuccess(t){if(this.param.asyn_res_cb){var e=this.main_index-1;this.param.asyn_res_cb(e,t)}this._successCountAndShow(),this.asyn_flg=0}_successCountAndShow(){this.success_count++,this.cSuccessDiv.html(this.success_count)}_addFail(t,e){var i=`\n\t\t\t<div style="display:inline-block">\n\t\t\t\t<input type="button" class="btn btn-default btn-xs" value="失敗 ${t}" onclick="jQuery('#req_batch_fail${t}').toggle(300)">\n\t\t\t\t<div id="req_batch_fail${t}" style="display:none">${e}</div>\n\t\t\t</div>\n\t\t`;this.failDiv.append(i)}_showFailCount(){this.fail_count++,this.cFailDiv.html(this.fail_count);var t="失敗("+this.fail_count+")";this.failBtn.attr("value",t)}_checkFailLimit(){if(this.fail_count>this.param.fail_limit){this.stopThread();var t=`失敗数が${this.param.fail_limit}回を超えたので処理を中断します。`;this.errDiv.html(t)}}stopThread(){for(var t in this.handlers){var e=this.handlers[t];clearInterval(e)}}_showMemory(){if(null!=this.mems){var t=performance.memory.usedJSHeapSize-this.mems.usedJSHeapSize1;this.cMemDiv.html(t)}}_resetMemoryData(){var t=performance.memory;return null==t?null:{jsHeapSizeLimit1:t.jsHeapSizeLimit,totalJSHeapSize1:t.totalJSHeapSize,usedJSHeapSize1:t.usedJSHeapSize}}}